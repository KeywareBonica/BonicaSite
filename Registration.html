<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registration - Bonica</title>
  <meta name="description" content="Create your account for Bonica event services">
  <meta name="keywords" content="registration, signup, event management, final year project, account creation">
  <meta name="author" content="Keyware Development Company">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Professional Theme CSS -->
  <link href="css/professional-theme.css" rel="stylesheet">
  <!-- Navigation CSS -->
  <link href="css/navigation.css" rel="stylesheet">

  <!-- Custom Registration Styles -->
  <style>
    body {
      background: var(--background-secondary);
      min-height: 100vh;
    }

    .registration-container {
      max-width: var(--container-xl);
      margin: 0 auto;
      padding: var(--spacing-md);
    }

    .registration-header {
      text-align: center;
      margin-bottom: 3rem;
    }

    .registration-logo {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 1.5rem;
      color: white;
      font-size: 2rem;
      box-shadow: var(--shadow-lg);
    }
    
    /* Responsive Registration Styles */
    @media (max-width: 768px) {
      .registration-container {
        padding: var(--spacing-sm);
      }
      
      .registration-header {
        margin-bottom: var(--spacing-lg);
      }
      
      .registration-logo {
        width: 60px;
        height: 60px;
        font-size: 1.5rem;
        margin-bottom: var(--spacing-md);
      }
      
      .registration-title {
        font-size: var(--heading-size-mobile);
        margin-bottom: var(--spacing-sm);
      }
      
      .registration-subtitle {
        font-size: var(--font-size-mobile);
        margin-bottom: var(--spacing-md);
      }
      
      .form-section {
        margin-bottom: var(--spacing-lg);
      }
      
      .form-section h3 {
        font-size: var(--heading-size-mobile);
        margin-bottom: var(--spacing-md);
      }
      
      .form-row {
        flex-direction: column;
        gap: var(--spacing-sm);
      }
      
      .form-group {
        margin-bottom: var(--spacing-md);
      }
      
      .form-control {
        padding: var(--spacing-md);
        font-size: var(--font-size-mobile);
      }
      
      .form-select {
        padding: var(--spacing-md);
        font-size: var(--font-size-mobile);
      }
      
      .btn-submit {
        padding: var(--spacing-md) var(--spacing-lg);
        font-size: var(--font-size-mobile);
        width: 100%;
      }
      
      .operating-days-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-sm);
      }
      
      .day-card {
        padding: var(--spacing-sm);
        font-size: var(--font-size-mobile);
      }
    }
    
    @media (min-width: 768px) and (max-width: 1024px) {
      .registration-container {
        padding: var(--spacing-lg);
      }
      
      .registration-logo {
        width: 80px;
        height: 80px;
        font-size: 2rem;
      }
      
      .registration-title {
        font-size: var(--heading-size-tablet);
      }
      
      .registration-subtitle {
        font-size: var(--font-size-tablet);
      }
      
      .form-control,
      .form-select {
        font-size: var(--font-size-tablet);
      }
      
      .operating-days-grid {
        grid-template-columns: repeat(3, 1fr);
      }
    }
    
    @media (min-width: 1024px) {
      .registration-logo {
        width: 100px;
        height: 100px;
        font-size: 2.5rem;
      }
      
      .registration-title {
        font-size: var(--heading-size-desktop);
      }
      
      .registration-subtitle {
        font-size: var(--font-size-desktop);
      }
      
      .form-control,
      .form-select {
        font-size: var(--font-size-desktop);
      }
      
      .operating-days-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }
    
    @media (min-width: 1920px) {
      .registration-container {
        max-width: var(--container-tv);
        padding: var(--spacing-tv);
      }
      
      .registration-logo {
        width: 120px;
        height: 120px;
        font-size: 3rem;
        margin-bottom: var(--spacing-xl);
      }
      
      .registration-title {
        font-size: var(--heading-size-tv);
        margin-bottom: var(--spacing-lg);
      }
      
      .registration-subtitle {
        font-size: var(--font-size-tv);
        margin-bottom: var(--spacing-xl);
      }
      
      .form-section h3 {
        font-size: var(--heading-size-tv);
        margin-bottom: var(--spacing-xl);
      }
      
      .form-control,
      .form-select {
        padding: var(--spacing-xl);
        font-size: var(--font-size-tv);
      }
      
      .btn-submit {
        padding: var(--spacing-xl) var(--spacing-2xl);
        font-size: var(--font-size-tv);
      }
      
      .operating-days-grid {
        grid-template-columns: repeat(5, 1fr);
        gap: var(--spacing-lg);
      }
      
      .day-card {
        padding: var(--spacing-lg);
        font-size: var(--font-size-tv);
      }
    }

    .registration-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .registration-subtitle {
      color: var(--text-secondary);
      font-size: 1.1rem;
    }

    /* Info Icon Styling */
    .info-icon {
      color: #6c757d;
      cursor: help;
      font-size: 0.9rem;
      margin-left: 0.25rem;
      transition: color 0.2s ease;
    }

    .info-icon:hover {
      color: #3b82f6;
    }

    /* Tooltip Styling */
    .tooltip {
      font-size: 0.875rem;
    }

    .tooltip-inner {
      background-color: #2d3748;
      color: white;
      border-radius: 0.375rem;
      padding: 0.5rem 0.75rem;
      max-width: 250px;
    }

    .bs-tooltip-top .tooltip-arrow::before {
      border-top-color: #2d3748;
    }

    .bs-tooltip-bottom .tooltip-arrow::before {
      border-bottom-color: #2d3748;
    }

    .registration-card {
      background: var(--background-primary);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-xl);
      border: 1px solid rgba(59, 130, 246, 0.1);
      overflow: hidden;
    }

    .registration-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--primary-blue), var(--accent-blue), var(--primary-blue));
    }

    .user-type-selection {
      background: var(--secondary-blue);
      padding: 2rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .user-type-options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-top: 1rem;
    }

    .user-type-option {
      padding: 1.5rem;
      border: 2px solid #e5e7eb;
      border-radius: var(--radius-lg);
      text-align: center;
      cursor: pointer;
      transition: var(--transition-fast);
      background: var(--background-primary);
    }

    .user-type-option:hover {
      border-color: var(--primary-blue);
      background: var(--secondary-blue);
    }

    .user-type-option.selected {
      border-color: var(--primary-blue);
      background: var(--primary-blue);
      color: white;
    }

    .user-type-option i {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      display: block;
    }

    .form-section {
      padding: 2rem;
    }

    .form-section h5 {
      color: var(--primary-blue);
      margin-bottom: 1.5rem;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .password-container {
      position: relative;
    }

    .password-toggle {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      color: var(--text-muted);
      font-size: 1.2rem;
      transition: var(--transition-fast);
    }

    .password-toggle:hover {
      color: var(--primary-blue);
    }

    .error {
      color: var(--error);
      font-size: 0.85rem;
      margin-top: 0.25rem;
      display: block;
    }

    .success-message {
      color: var(--success);
      text-align: center;
      margin-top: 1rem;
      padding: 0.75rem;
      background: rgba(16, 185, 129, 0.1);
      border: 1px solid rgba(16, 185, 129, 0.3);
      border-radius: var(--radius-md);
      display: none;
    }

    .error-message {
      color: var(--error);
      text-align: center;
      margin-top: 1rem;
      padding: 0.75rem;
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      border-radius: var(--radius-md);
      display: none;
    }

    .btn-register {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-blue-light) 100%);
      color: white;
      border: none;
      border-radius: var(--radius-md);
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .btn-register:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
      background: linear-gradient(135deg, var(--primary-blue-dark) 0%, var(--primary-blue) 100%);
    }

    .btn-register:disabled {
      opacity: 0.7;
      cursor: not-allowed;
      transform: none;
    }

    /* Password Strength Indicator */
    .password-strength {
      margin-top: 0.5rem;
    }

    .strength-bar {
      width: 100%;
      height: 4px;
      background-color: #e5e7eb;
      border-radius: 2px;
      overflow: hidden;
      margin-bottom: 0.25rem;
    }

    .strength-fill {
      height: 100%;
      width: 0%;
      transition: all 0.3s ease;
      border-radius: 2px;
    }

    .strength-fill.weak {
      width: 25%;
      background-color: #ef4444;
    }

    .strength-fill.fair {
      width: 50%;
      background-color: #f59e0b;
    }

    .strength-fill.good {
      width: 75%;
      background-color: #3b82f6;
    }

    .strength-fill.strong {
      width: 100%;
      background-color: #10b981;
    }

    .strength-text {
      font-size: 0.75rem;
      color: #6b7280;
      text-align: center;
    }

    .strength-text.weak {
      color: #ef4444;
    }

    .strength-text.fair {
      color: #f59e0b;
    }

    .strength-text.good {
      color: #3b82f6;
    }

    .strength-text.strong {
      color: #10b981;
    }

    /* Operating Times Styling */
    .operating-times-container {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .time-separator {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary-blue);
      padding: 0.5rem;
      min-width: 2rem;
      text-align: center;
      background: var(--secondary-blue);
      border-radius: var(--radius-md);
    }

    /* Tooltip Styling */
    .tooltip-trigger {
      color: var(--primary-blue);
      cursor: help;
      margin-left: 0.5rem;
      font-size: 0.9rem;
      transition: color 0.2s ease;
    }

    .tooltip-trigger:hover {
      color: var(--primary-blue-dark);
    }

    .tooltip {
      position: absolute;
      background: #1f2937;
      color: white;
      padding: 0.75rem 1rem;
      border-radius: var(--radius-md);
      font-size: 0.85rem;
      max-width: 250px;
      z-index: 1000;
      box-shadow: var(--shadow-lg);
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
      pointer-events: none;
    }

    .tooltip.show {
      opacity: 1;
      visibility: visible;
    }

    .tooltip::after {
      content: '';
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      border: 5px solid transparent;
      border-top-color: #1f2937;
    }

    /* Service Selection Styling */
    .service-selection-container {
      position: relative;
    }

    .service-select {
      font-size: 1rem;
      padding: 0.75rem 1rem;
      border: 2px solid #e5e7eb;
      border-radius: var(--radius-lg);
      transition: all 0.3s ease;
      background: white;
    }

    .service-select:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }

    .custom-service-container {
      margin-top: 1rem;
      padding: 1rem;
      background: var(--secondary-blue);
      border-radius: var(--radius-lg);
      border: 2px dashed var(--primary-blue);
    }

    /* Input Group Styling */
    .input-group-text {
      background: var(--primary-blue);
      color: white;
      border: 2px solid var(--primary-blue);
      font-weight: 600;
    }

    .input-group .form-control {
      border-left: none;
    }

    .input-group .form-control:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
    }


    /* Operating Days Styling */
    .operating-days-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 1rem;
      margin-top: 1rem;
    }

    .day-option {
      position: relative;
    }

    .day-checkbox {
      position: absolute;
      opacity: 0;
      cursor: pointer;
    }

    .day-label {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1rem 0.75rem;
      background: var(--background-primary);
      border: 2px solid #e5e7eb;
      border-radius: var(--radius-lg);
      cursor: pointer;
      transition: var(--transition-fast);
      text-align: center;
      min-height: 80px;
      justify-content: center;
    }

    .day-label:hover {
      border-color: var(--primary-blue);
      background: var(--secondary-blue);
      transform: translateY(-2px);
    }

    .day-checkbox:checked + .day-label {
      background: var(--primary-blue);
      border-color: var(--primary-blue);
      color: white;
      transform: translateY(-2px);
      box-shadow: var(--shadow-lg);
    }

    .day-name {
      font-size: 0.9rem;
      font-weight: 600;
      display: block;
      margin-bottom: 0.25rem;
    }

    .day-short {
      font-size: 0.75rem;
      opacity: 0.8;
      display: block;
    }

    @media (max-width: 768px) {
      .registration-container {
        padding: 1rem;
      }
      
      .user-type-options {
        grid-template-columns: 1fr;
      }
      
      .operating-days-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 0.75rem;
      }

      .day-label {
        padding: 0.75rem 0.5rem;
        min-height: 70px;
      }

      .day-name {
        font-size: 0.8rem;
      }

      .day-short {
        font-size: 0.7rem;
      }
    }
  </style>
  
  <!-- Navigation JavaScript -->
  <script src="js/navigation.js"></script>
</head>
<body>
  <!-- Academic Project Badge -->

  <!-- Professional Navigation -->
  <nav class="professional-nav">
    <div class="nav-container">
      <a href="index.html" class="logo">
        <img src="img/logo.jpeg" alt="Bonica Logo">
        <span>Bonica</span>
      </a>
      <button class="mobile-menu-toggle" onclick="toggleMobileMenu()">
        <i class="fas fa-bars"></i>
      </button>
      <ul class="nav-links" id="navLinks">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="services.html">Services</a></li>
        <li><a href="team.html">Team</a></li>
        <li><a href="contact.html">Contact</a></li>
      </ul>
      <div class="nav-actions">
        <a href="Login.html" class="btn btn-primary">
          <i class="fas fa-sign-in-alt me-2"></i>Sign In
        </a>
      </div>
    </div>
  </nav>

  <!-- Registration Container -->
  <div class="registration-container">
    <div class="registration-header">
      <div class="registration-logo">
        <i class="fas fa-user-plus"></i>
      </div>
      <h1 class="registration-title">Create Your Account</h1>
      <p class="registration-subtitle">Join our Event Management System and start managing your events professionally</p>
    </div>

    <div class="registration-card">
      <!-- User Type Selection -->
      <div class="user-type-selection">
        <h4 class="text-center mb-3">Choose Your Account Type</h4>
        <div class="user-type-options">
          <div class="user-type-option" data-type="customer" onclick="selectUserType('customer')">
            <i class="fas fa-user"></i>
            <h5>Customer</h5>
            <p>I want to book events and services</p>
            </div>
          <div class="user-type-option" data-type="service_provider" onclick="selectUserType('service_provider')">
            <i class="fas fa-briefcase"></i>
            <h5>Service Provider</h5>
            <p>I want to offer my services</p>
          </div>
        </div>
        <div class="error" id="usertypeSelectError"></div>
      </div>

      <!-- Registration Form -->
            <form id="registrationForm" style="display:none;" autocomplete="off">
                <!-- Customer Form -->
        <div id="customerForm" style="display:none;" class="form-section">
          <h5><i class="fas fa-user"></i> Customer Details</h5>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="name" class="form-label">
                        Name 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your first name using only letters and spaces. No numbers or special characters allowed.">🛈</span>
                      </label>
                      <input type="text" class="form-control" id="name" maxlength="50" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="nameError"></div>
                    </div>
                    <div class="col-md-6 mb-3">
                      <label for="surname" class="form-label">
                        Surname 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your last name using only letters and spaces. No numbers or special characters allowed.">🛈</span>
                      </label>
                      <input type="text" class="form-control" id="surname" maxlength="50" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="surnameError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="password" class="form-label">
                        Password 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Must be at least 8 characters with letters, numbers, and special characters.">🛈</span>
                      </label>
                      <div class="password-container">
                        <input type="password" class="form-control" id="password" autocomplete="new-password" spellcheck="false" autocorrect="off" autocapitalize="off" oninput="checkPasswordStrength('password')">
                        <span class="password-toggle" id="passwordToggle">👁️</span>
                      </div>
                      <div class="password-strength" id="passwordStrength">
                        <div class="strength-bar">
                          <div class="strength-fill" id="passwordStrengthFill"></div>
                        </div>
                        <div class="strength-text" id="passwordStrengthText">Password strength</div>
                      </div>
                      <div class="error" id="passwordError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="confirmPassword" class="form-label">
                        Re-type Password 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Re-enter your password exactly as above. Must match perfectly.">🛈</span>
                      </label>
                      <div class="password-container">
                        <input type="password" class="form-control" id="confirmPassword" autocomplete="new-password" spellcheck="false" autocorrect="off" autocapitalize="off">
                        <span class="password-toggle" id="confirmPasswordToggle">👁️</span>
                      </div>
                      <div class="error" id="confirmPasswordError"></div>
                    </div>


                    <div class="col-md-6 mb-3">
                      <label for="contact" class="form-label">
                        Contact Number 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your 10-digit cell phone number starting with 0. Example: 0123456789">🛈</span>
                      </label>
                      <input type="tel" class="form-control" id="contact" placeholder="0XXXXXXXXX" maxlength="10" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <small class="form-text text-muted">Enter 10-digit number starting with 0</small>
                      <div class="error" id="contactError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="email" class="form-label">
                        Email Address 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter a valid email address with @ and domain (.com, .co, .za, etc.)">🛈</span>
                      </label>
                      <input type="email" class="form-control" id="email" maxlength="254" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="emailError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="province" class="form-label">Province</label>
                      <input type="text" class="form-control" id="province" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="provinceError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="city" class="form-label">City</label>
                      <input type="text" class="form-control" id="city" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="cityError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="town" class="form-label">Town</label>
                      <input type="text" class="form-control" id="town" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="townError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="houseNumber" class="form-label">House Number</label>
                      <input type="text" class="form-control" id="houseNumber" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="houseNumberError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="streetName" class="form-label">Street Name</label>
                      <input type="text" class="form-control" id="streetName" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="streetNameError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="postalCode" class="form-label">Postal Code</label>
                      <input type="text" class="form-control" id="postalCode" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="postalCodeError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="notification" class="form-label">Preferred Notification</label>
                      <select class="form-select" id="notification">
                        <option selected disabled value="">Select option</option>
                        <option value="email">Email</option>
                        <option value="sms">SMS</option>
                      </select>
                      <div class="error" id="notificationError"></div>
                    </div>
                  </div>
                </div>

                <!-- Service Provider Form -->
        <div id="serviceProviderForm" style="display:none;" class="form-section">
          <h5><i class="fas fa-briefcase"></i> Service Provider Details</h5>
                  <div class="row">
                    <div class="col-md-6 mb-3">
                      <label for="spName" class="form-label">Name</label>
                      <input type="text" class="form-control" id="spName" maxlength="50" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="spNameError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spSurname" class="form-label">Surname</label>
                      <input type="text" class="form-control" id="spSurname" maxlength="50" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="spSurnameError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spPassword" class="form-label">Password</label>
                      <div class="password-container">
                        <input type="password" class="form-control" id="spPassword" autocomplete="new-password" spellcheck="false" autocorrect="off" autocapitalize="off" oninput="checkPasswordStrength('spPassword')">
                        <span class="password-toggle" id="spPasswordToggle">👁️</span>
                      </div>
                      <div class="password-strength" id="spPasswordStrength">
                        <div class="strength-bar">
                          <div class="strength-fill" id="spPasswordStrengthFill"></div>
                        </div>
                        <div class="strength-text" id="spPasswordStrengthText">Password strength</div>
                      </div>
                      <div class="error" id="spPasswordError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spConfirmPassword" class="form-label">Re-type Password</label>
                      <div class="password-container">
                        <input type="password" class="form-control" id="spConfirmPassword" autocomplete="new-password" spellcheck="false" autocorrect="off" autocapitalize="off">
                        <span class="password-toggle" id="spConfirmPasswordToggle">👁️</span>
                      </div>
                      <div class="error" id="spConfirmPasswordError"></div>
                    </div>


                    <div class="col-md-6 mb-3">
                      <label for="spContact" class="form-label">Contact No</label>
                      <input type="tel" class="form-control" id="spContact" placeholder="0XXXXXXXXX" maxlength="10" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <small class="form-text text-muted">Enter 10-digit number starting with 0</small>
                      <div class="error" id="spContactError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spEmail" class="form-label">Email</label>
                      <input type="email" class="form-control" id="spEmail" maxlength="254" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="spEmailError"></div>
                    </div>


                    <div class="col-md-6 mb-3">
                      <label for="spLocation" class="form-label">Location</label>
                      <input type="text" class="form-control" id="spLocation" 
                             data-location-input="true"
                             data-placeholder="Enter your business address"
                             data-validation="true"
                             data-autocomplete="true"
                             autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <div class="error" id="spLocationError"></div>
                      <small class="form-text text-muted">
                        <i class="fas fa-map-marker-alt me-1"></i>
                        Enter your business address for location-based matching with clients
                      </small>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label class="form-label" style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1rem; display: block;">Operating Days</label>
                      <div id="spOperatingDays" class="operating-days-container">
                        <div class="day-option">
                          <input class="day-checkbox" type="checkbox" value="Monday" id="monday">
                          <label class="day-label" for="monday">
                            <span class="day-name">Monday</span>
                            <span class="day-short">Mon</span>
                          </label>
                        </div>
                        <div class="day-option">
                          <input class="day-checkbox" type="checkbox" value="Tuesday" id="tuesday">
                          <label class="day-label" for="tuesday">
                            <span class="day-name">Tuesday</span>
                            <span class="day-short">Tue</span>
                          </label>
                        </div>
                        <div class="day-option">
                          <input class="day-checkbox" type="checkbox" value="Wednesday" id="wednesday">
                          <label class="day-label" for="wednesday">
                            <span class="day-name">Wednesday</span>
                            <span class="day-short">Wed</span>
                          </label>
                        </div>
                        <div class="day-option">
                          <input class="day-checkbox" type="checkbox" value="Thursday" id="thursday">
                          <label class="day-label" for="thursday">
                            <span class="day-name">Thursday</span>
                            <span class="day-short">Thu</span>
                          </label>
                        </div>
                        <div class="day-option">
                          <input class="day-checkbox" type="checkbox" value="Friday" id="friday">
                          <label class="day-label" for="friday">
                            <span class="day-name">Friday</span>
                            <span class="day-short">Fri</span>
                          </label>
                        </div>
                        <div class="day-option">
                          <input class="day-checkbox" type="checkbox" value="Saturday" id="saturday">
                          <label class="day-label" for="saturday">
                            <span class="day-name">Saturday</span>
                            <span class="day-short">Sat</span>
                          </label>
                        </div>
                        <div class="day-option">
                          <input class="day-checkbox" type="checkbox" value="Sunday" id="sunday">
                          <label class="day-label" for="sunday">
                            <span class="day-name">Sunday</span>
                            <span class="day-short">Sun</span>
                          </label>
                        </div>
                      </div>

                      <div class="error" id="spOperatingDaysError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spOperatingTimes" class="form-label">Operating Times</label>
                      <div class="operating-times-container">
                        <input type="time" class="form-control" id="spOperatingTimeStart">
                        <span class="time-separator">to</span>
                        <input type="time" class="form-control" id="spOperatingTimeEnd">
                      </div>
                      <div class="error" id="spOperatingTimesError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spBasePrice" class="form-label">
                        Base Price 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your hourly rate using numbers only (e.g., 150.00). No letters or special characters allowed.">🛈</span>
                      </label>
                      <div class="input-group">
                        <span class="input-group-text">R</span>
                        <input type="number" class="form-control" id="spBasePrice" placeholder="0.00" step="0.01" min="1" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      </div>
                      <div class="error" id="spBasePriceError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spOvertimeRate" class="form-label">
                        Overtime Rate 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter your overtime rate using numbers only (e.g., 200.00). No letters or special characters allowed.">🛈</span>
                      </label>
                      <div class="input-group">
                        <span class="input-group-text">R</span>
                        <input type="number" class="form-control" id="spOvertimeRate" placeholder="0.00" step="0.01" min="1" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      </div>
                      <div class="error" id="spOvertimeRateError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spCaption" class="form-label">
                        Caption 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter a short tagline using only letters, spaces, and hyphens. No hashtags, numbers, or special characters allowed.">🛈</span>
                      </label>
                      <input type="text" class="form-control" id="spCaption" placeholder="e.g., 'Professional DJ Services'" maxlength="100" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off">
                      <small class="form-text text-muted">Short tagline (max 100 characters)</small>
                      <div class="error" id="spCaptionError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spDescription" class="form-label">
                        Description 
                        <span class="info-icon" data-bs-toggle="tooltip" data-bs-placement="top" title="Enter a detailed description using only letters, spaces, and hyphens. No hashtags, numbers, or special characters allowed.">🛈</span>
                      </label>
                      <textarea class="form-control" id="spDescription" rows="3" placeholder="Describe your services, experience, and what makes you special..." maxlength="500" autocomplete="off" spellcheck="false" autocorrect="off" autocapitalize="off"></textarea>
                      <small class="form-text text-muted">Detailed description (max 500 characters)</small>
                      <div class="error" id="spDescriptionError"></div>
                    </div>

                    <div class="col-md-6 mb-3">
                      <label for="spService" class="form-label">
                        Service Type
                        <i class="fas fa-info-circle tooltip-trigger" 
                           data-tooltip="Select your primary service type. You can add custom services if yours is not listed."></i>
                      </label>
                      <div class="service-selection-container">
                        <select class="form-select service-select" id="spService">
                          <option selected disabled value="">Choose your service type</option>
                          <option value="custom">Other/Custom Service</option>
                      </select>
                        <div id="customServiceContainer" class="custom-service-container" style="display: none;">
                          <input type="text" class="form-control mt-2" id="customServiceName" placeholder="Enter your custom service name" maxlength="50">
                          <small class="form-text text-muted">Describe your unique service (max 50 characters)</small>
                        </div>
                      </div>
                      <div class="error" id="spServiceError"></div>
                    </div>
                  </div>
                </div>

        <div class="form-section">
          <button type="submit" class="btn-register" id="submitBtn">
            <span id="btnText">Create Account</span>
          </button>

                <div class="success-message" id="successMessage"></div>
          <div class="error-message" id="errorMessage"></div>
          
          <div class="text-center mt-3">
            <small>Already have an account? <a href="Login.html" class="text-primary">Login here</a></small>
          </div>
        </div>
              </form>

            </div>
          </div>

  <!-- Professional Footer -->
  <footer class="professional-footer">
    <div class="footer-content">
      <div class="footer-grid">
        <div class="footer-section">
          <h3>Event Management System</h3>
          <p>A comprehensive final year project showcasing modern web development technologies and best practices in event management.</p>
        </div>
        <div class="footer-section">
          <h3>Quick Links</h3>
          <ul>
            <li><a href="index.html">Home</a></li>
            <li><a href="Login.html">Login</a></li>
            <li><a href="Registration.html">Register</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Contact Information</h3>
          <p><i class="fas fa-map-marker-alt me-2"></i> Joriseen Street, Johannesburg</p>
          <p><i class="fas fa-phone me-2"></i> +27 76 244 9990</p>
          <p><i class="fas fa-envelope me-2"></i> <a href="mailto:Bonica@gmail.com">Bonica@gmail.com</a></p>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2025 Bonica. All rights reserved. | Developed by Keyware Development Company</p>
    </div>
      </div>
    </footer>

  <!-- Bootstrap JS (kept same as original) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Supabase JS (as in your original) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Security System -->
  <script src="js/security-system.js"></script>
  
  <!-- Form Validation System -->
  <script src="js/form-validation.js"></script>
  
  <!-- Location Services -->
  <script src="js/location-service.js"></script>
  <script src="js/location-input.js"></script>
  <script src="js/simple-location.js"></script>
  <!-- Encryption Services -->
  <script src="js/encryption.js"></script>
  
  <!-- Email Notification Service -->
  <script src="js/email-notification-service.js"></script>

  <!-- JavaScript -->
  <script>
  // Supabase initialization with proper error handling
  const SUPABASE_URL = "https://spudtrptbyvwyhvistdf.supabase.co";
  const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNwdWR0cnB0Ynl2d3lodmlzdGRmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTU2OTk4NjgsImV4cCI6MjA3MTI3NTg2OH0.GBo-RtgbRZCmhSAZi0c5oXynMiJNeyrs0nLsk3CaV8A"; 
  
  let supabaseClient = null;
  let formValidator = null;
  
  // Initialize Supabase with proper error handling
  try {
    // Check if supabase is loaded
    if (typeof window.supabase === 'undefined') {
      throw new Error('Supabase library not loaded');
    }
    
    // Use destructuring syntax for better compatibility
    const { createClient } = window.supabase;
    supabaseClient = createClient(SUPABASE_URL, SUPABASE_KEY);
    
    // Initialize form validator
    formValidator = new FormValidator();
    
    console.log('✅ Supabase client initialized successfully');
    console.log('✅ Form validator initialized successfully');
    
    // Test connection
    testSupabaseConnection();
    
  } catch (error) {
    console.error('❌ Supabase initialization failed:', error);
    showSupabaseError();
  }
  
  // Test Supabase connection
  async function testSupabaseConnection() {
    try {
      const { data, error } = await supabaseClient.from('client').select('count').limit(1);
      if (error) {
        console.warn('⚠️ Supabase connection test failed:', error.message);
        showSupabaseWarning();
      } else {
        console.log('✅ Supabase connection test successful');
      }
    } catch (error) {
      console.warn('⚠️ Supabase connection test failed:', error);
      showSupabaseWarning();
    }
  }
  
  // Show error message for failed Supabase loading
  function showSupabaseError() {
    const errorDiv = document.createElement('div');
    errorDiv.innerHTML = `
      <div class="alert alert-danger" role="alert">
        <h4 class="alert-heading">Database Connection Error</h4>
        <p>Unable to connect to the database. Please:</p>
        <ul>
          <li>Check your internet connection</li>
          <li>Refresh the page (Ctrl+F5)</li>
          <li>Try again in a few minutes</li>
        </ul>
        <hr>
        <p class="mb-0">If the problem persists, please contact support.</p>
      </div>
    `;
    document.querySelector('.registration-container').insertBefore(errorDiv, document.querySelector('.registration-container').firstChild);
  }
  
  // Show warning for connection issues
  function showSupabaseWarning() {
    const warningDiv = document.createElement('div');
    warningDiv.innerHTML = `
      <div class="alert alert-warning" role="alert">
        <strong>Warning:</strong> Database connection issues detected. Registration may not work properly.
      </div>
    `;
    document.querySelector('.registration-container').insertBefore(warningDiv, document.querySelector('.registration-container').firstChild);
  }

  // Password strength checker
  function checkPasswordStrength(inputId) {
    const password = document.getElementById(inputId).value;
    const strengthFill = document.getElementById(inputId + 'StrengthFill');
    const strengthText = document.getElementById(inputId + 'StrengthText');
    
    let score = 0;
    let feedback = '';
    
    // Length check
    if (password.length >= 8) score += 1;
    
    // Letter check
    if (/[a-zA-Z]/.test(password)) score += 1;
    
    // Number check
    if (/\d/.test(password)) score += 1;
    
    // Special character check
    if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) score += 1;
    
    // Reset classes
    strengthFill.className = 'strength-fill';
    strengthText.className = 'strength-text';
    
    if (password.length === 0) {
      strengthText.textContent = 'Password strength';
      return;
    }
    
    if (score <= 1) {
      strengthFill.classList.add('weak');
      strengthText.classList.add('weak');
      strengthText.textContent = 'Weak - Add letters, numbers, and special characters';
    } else if (score === 2) {
      strengthFill.classList.add('fair');
      strengthText.classList.add('fair');
      strengthText.textContent = 'Fair - Add more characters and special symbols';
    } else if (score === 3) {
      strengthFill.classList.add('good');
      strengthText.classList.add('good');
      strengthText.textContent = 'Good - Strong password!';
    } else if (score === 4) {
      strengthFill.classList.add('strong');
      strengthText.classList.add('strong');
      strengthText.textContent = 'Strong - Excellent password!';
    }
  }

  // Initialize tooltips
  function initializeTooltips() {
    const tooltipTriggers = document.querySelectorAll('.tooltip-trigger');
    
    tooltipTriggers.forEach(trigger => {
      const tooltip = document.createElement('div');
      tooltip.className = 'tooltip';
      tooltip.textContent = trigger.getAttribute('data-tooltip');
      document.body.appendChild(tooltip);
      
      trigger.addEventListener('mouseenter', (e) => {
        const rect = trigger.getBoundingClientRect();
        tooltip.style.left = rect.left + 'px';
        tooltip.style.top = (rect.top - tooltip.offsetHeight - 10) + 'px';
        tooltip.classList.add('show');
      });
      
      trigger.addEventListener('mouseleave', () => {
        tooltip.classList.remove('show');
      });

      // Also handle click events for mobile
      trigger.addEventListener('click', (e) => {
        e.preventDefault();
        const rect = trigger.getBoundingClientRect();
        tooltip.style.left = rect.left + 'px';
        tooltip.style.top = (rect.top - tooltip.offsetHeight - 10) + 'px';
        tooltip.classList.toggle('show');
      });
    });
  }

  // Load services from database
  async function loadServicesFromDatabase() {
    try {
      if (!supabaseClient) {
        console.warn('⚠️ Supabase client not available, skipping service loading');
        return;
      }
      
      const { data: services, error } = await supabaseClient
        .from('service')
        .select('service_id, service_name, service_type, service_description')
        .order('service_name');

      if (error) {
        console.error('Error loading services:', error);
        return;
      }

      const serviceSelect = document.getElementById('spService');
      
      // Clear existing options except the first two
      serviceSelect.innerHTML = `
        <option selected disabled value="">Choose your service type</option>
        <option value="custom">Other/Custom Service</option>
      `;

      // Add services from database
      services.forEach(service => {
        const option = document.createElement('option');
        option.value = service.service_id;
        option.textContent = service.service_name;
        serviceSelect.appendChild(option);
      });

      console.log('✅ Services loaded from database:', services.length);
    } catch (error) {
      console.error('Error loading services:', error);
    }
  }

  // Initialize service selection
  function initializeServiceSelection() {
    const serviceSelect = document.getElementById('spService');
    const customContainer = document.getElementById('customServiceContainer');
    const customInput = document.getElementById('customServiceName');
    
    serviceSelect.addEventListener('change', () => {
      if (serviceSelect.value === 'custom') {
        customContainer.style.display = 'block';
        customInput.required = true;
      } else {
        customContainer.style.display = 'none';
        customInput.required = false;
        customInput.value = '';
      }
    });

    // Initialize operating days validation
    initializeOperatingDaysValidation();

    // Initialize time validation
    initializeTimeValidation();
  }

  // Initialize time validation
  function initializeTimeValidation() {
    const startTimeInput = document.getElementById('spOperatingTimeStart');
    const endTimeInput = document.getElementById('spOperatingTimeEnd');
    const errorElement = document.getElementById('spOperatingTimesError');
    
    function validateTimes() {
      const startTime = startTimeInput.value;
      const endTime = endTimeInput.value;
      
      if (startTime && endTime) {
        const start = new Date(`2000-01-01T${startTime}`);
        const end = new Date(`2000-01-01T${endTime}`);
        
        if (start >= end) {
          errorElement.textContent = 'Start time must be before end time';
          errorElement.style.display = 'block';
          startTimeInput.classList.add('is-invalid');
          endTimeInput.classList.add('is-invalid');
        } else {
          errorElement.textContent = '';
          errorElement.style.display = 'none';
          startTimeInput.classList.remove('is-invalid');
          endTimeInput.classList.remove('is-invalid');
          startTimeInput.classList.add('is-valid');
          endTimeInput.classList.add('is-valid');
        }
      }
    }
    
    startTimeInput.addEventListener('change', validateTimes);
    endTimeInput.addEventListener('change', validateTimes);
  }

  // Initialize operating days validation
  function initializeOperatingDaysValidation() {
    const operatingDayCheckboxes = document.querySelectorAll('#spOperatingDays input[type="checkbox"]');
    const errorElement = document.getElementById('spOperatingDaysError');
    
    operatingDayCheckboxes.forEach(checkbox => {
      checkbox.addEventListener('change', () => {
        const checkedDays = document.querySelectorAll('#spOperatingDays input:checked');
        if (checkedDays.length > 0) {
          errorElement.textContent = '';
          errorElement.style.display = 'none';
        }
      });
    });
  }

  // Initialize password matching validation
  function initializePasswordMatching() {
    const passwordFields = ['password', 'spPassword'];
    const confirmFields = ['confirmPassword', 'spConfirmPassword'];
    
    passwordFields.forEach((passwordId, index) => {
      const passwordInput = document.getElementById(passwordId);
      const confirmInput = document.getElementById(confirmFields[index]);
      
      if (passwordInput && confirmInput) {
        // Real-time validation when typing in confirm password
        confirmInput.addEventListener('input', () => {
          const password = passwordInput.value;
          const confirm = confirmInput.value;
          
          if (confirm && password !== confirm) {
            confirmInput.classList.add('is-invalid');
            confirmInput.classList.remove('is-valid');
          } else if (confirm && password === confirm) {
            confirmInput.classList.remove('is-invalid');
            confirmInput.classList.add('is-valid');
          } else {
            confirmInput.classList.remove('is-invalid', 'is-valid');
          }
        });
        
        // Also validate when typing in main password
        passwordInput.addEventListener('input', () => {
          const password = passwordInput.value;
          const confirm = confirmInput.value;
          
          if (confirm && password !== confirm) {
            confirmInput.classList.add('is-invalid');
            confirmInput.classList.remove('is-valid');
          } else if (confirm && password === confirm) {
            confirmInput.classList.remove('is-invalid');
            confirmInput.classList.add('is-valid');
          }
        });
      }
    });
  }

  // Initialize phone number formatting
  function initializePhoneFormatting() {
    const phoneInputs = ['spContact', 'contact'];
    
    phoneInputs.forEach(inputId => {
      const input = document.getElementById(inputId);
      if (input) {
        input.addEventListener('input', (e) => {
          let value = e.target.value.replace(/\D/g, ''); // Remove non-digits
          
          // Ensure it starts with 0 and is max 10 digits
          if (value.length > 0 && !value.startsWith('0')) {
            value = '0' + value;
          }
          
          if (value.length > 10) {
            value = value.substring(0, 10);
          }
          
          e.target.value = value;
        });
        
        input.addEventListener('blur', (e) => {
          const value = e.target.value;
          if (value.length > 0 && value.length !== 10) {
            e.target.classList.add('is-invalid');
          } else {
            e.target.classList.remove('is-invalid');
          }
        });
      }
    });
  }

  // Check if email exists in system
  async function checkEmailExists(email, userType) {
    try {
      if (!supabaseClient) {
        console.warn('⚠️ Supabase client not available, skipping email check');
        return false;
      }
      
      const tableName = userType === 'customer' ? 'client' : 'service_provider';
      const emailField = userType === 'customer' ? 'client_email' : 'service_provider_email';
      
      const { data, error } = await supabaseClient
        .from(tableName)
        .select(emailField)
        .eq(emailField, email.toLowerCase())
        .single();
      
      return !error && data; // Returns true if email exists
    } catch (error) {
      return false; // If error, assume email doesn't exist
    }
  }

  // Check if phone exists in system
  async function checkPhoneExists(phone, userType) {
    try {
      if (!supabaseClient) {
        console.warn('⚠️ Supabase client not available, skipping phone check');
        return false;
      }
      
      const tableName = userType === 'customer' ? 'client' : 'service_provider';
      const phoneField = userType === 'customer' ? 'client_contact' : 'service_provider_contactno';
      
      const { data, error } = await supabaseClient
        .from(tableName)
        .select(phoneField)
        .eq(phoneField, phone)
        .single();
      
      return !error && data; // Returns true if phone exists
    } catch (error) {
      return false; // If error, assume phone doesn't exist
    }
  }

  // User type selection function
  function selectUserType(type) {
    // Remove selected class from all options
    document.querySelectorAll('.user-type-option').forEach(option => {
      option.classList.remove('selected');
    });
    
    // Add selected class to clicked option
    document.querySelector(`[data-type="${type}"]`).classList.add('selected');
    
    // Show registration form
    const registrationForm = document.getElementById('registrationForm');
    const customerForm = document.getElementById('customerForm');
    const serviceProviderForm = document.getElementById('serviceProviderForm');
    
    registrationForm.style.display = 'block';
    
    if (type === 'customer') {
      customerForm.style.display = 'block';
      serviceProviderForm.style.display = 'none';
    } else {
      customerForm.style.display = 'none';
      serviceProviderForm.style.display = 'block';
    }
    
    // Clear any previous errors
    document.getElementById('usertypeSelectError').textContent = '';
  }

  document.addEventListener('DOMContentLoaded', async () => {
    const registrationForm = document.getElementById('registrationForm');
    const customerForm = document.getElementById('customerForm');
    const serviceProviderForm = document.getElementById('serviceProviderForm');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');

    // Initialize Bootstrap tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl);
    });

    // Initialize real-time validation with new system
    addRealTimeValidationNew();

    // Initialize tooltips
    initializeTooltips();

    // Load services from database
    await loadServicesFromDatabase();

    // Initialize service selection
    initializeServiceSelection();

    // Initialize phone number formatting
    initializePhoneFormatting();

    // Initialize password matching validation
    initializePasswordMatching();

    // Services are already hardcoded in the HTML to match booking process
    // No need to load from database to avoid duplicates

    // Get selected user type
    function getSelectedUserType() {
      const selectedOption = document.querySelector('.user-type-option.selected');
      return selectedOption ? selectedOption.dataset.type : null;
    }

    // Password toggles
    const togglePassword = (inputId, toggleId) => {
      const input = document.getElementById(inputId);
      const toggle = document.getElementById(toggleId);
      if (input && toggle) {
        toggle.addEventListener('click', () => {
          input.type = input.type==='password'?'text':'password';
          // Update emoji based on password visibility
          toggle.textContent = input.type === 'password' ? '👁️' : '🙈';
        });
      }
    };
    togglePassword('password','passwordToggle');
    togglePassword('confirmPassword','confirmPasswordToggle');
    togglePassword('spPassword','spPasswordToggle');
    togglePassword('spConfirmPassword','spConfirmPasswordToggle');

    // Helper function to collect form data
    function collectFormData(userType) {
      const formData = {};
      
      if (userType === 'customer') {
        formData.name = document.getElementById('name').value;
        formData.surname = document.getElementById('surname').value;
        formData.password = document.getElementById('password').value;
        formData.confirmPassword = document.getElementById('confirmPassword').value;
        formData.email = document.getElementById('email').value;
        formData.contact = document.getElementById('contact').value;
        formData.province = document.getElementById('province').value;
        formData.city = document.getElementById('city').value;
        formData.town = document.getElementById('town').value;
        formData.houseNumber = document.getElementById('houseNumber').value;
        formData.streetName = document.getElementById('streetName').value;
        formData.postalCode = document.getElementById('postalCode').value;
      } else {
        formData.spName = document.getElementById('spName').value;
        formData.spSurname = document.getElementById('spSurname').value;
        formData.spPassword = document.getElementById('spPassword').value;
        formData.spConfirmPassword = document.getElementById('spConfirmPassword').value;
        formData.spEmail = document.getElementById('spEmail').value;
        formData.spContact = document.getElementById('spContact').value;
        formData.spLocation = document.getElementById('spLocation').value;
        formData.spCaption = document.getElementById('spCaption').value;
        formData.spDescription = document.getElementById('spDescription').value;
        formData.spBasePrice = document.getElementById('spBasePrice').value;
        formData.spOvertimeRate = document.getElementById('spOvertimeRate').value;
        formData.spService = document.getElementById('spService').value;
        formData.customServiceName = document.getElementById('customServiceName').value;
        
        // Collect operating days
        const operatingDays = [];
        const dayCheckboxes = document.querySelectorAll('#spOperatingDays input[type="checkbox"]:checked');
        dayCheckboxes.forEach(checkbox => {
          operatingDays.push(checkbox.value);
        });
        formData.spOperatingDays = operatingDays;
      }
      
      return formData;
    }

    // Helper function to display validation errors
    function displayValidationErrors(errors) {
      Object.keys(errors).forEach(fieldId => {
        const fieldErrors = errors[fieldId];
        if (fieldErrors && fieldErrors.length > 0) {
          formValidator.displayErrors(fieldId, fieldErrors);
        }
      });
    }

    // Helper function to clear all errors
    function clearAllErrors() {
      const errorElements = document.querySelectorAll('.error');
      errorElements.forEach(element => {
        element.textContent = '';
        element.style.display = 'none';
      });
      
      const invalidFields = document.querySelectorAll('.is-invalid');
      invalidFields.forEach(field => {
        field.classList.remove('is-invalid');
        field.classList.add('is-valid');
      });
    }

    // Form submission with comprehensive validation
    registrationForm.addEventListener('submit', async (e) => {
      e.preventDefault(); // Stop the page from reloading
      errorMessage.style.display='none';
      successMessage.style.display='none';

      const userType = getSelectedUserType();
      
      if (!userType) {
        document.getElementById('usertypeSelectError').textContent = 'Please select a user type';
        return;
      }

      // Collect form data
      const formData = collectFormData(userType);
      
      // Validate form using comprehensive validation system
      if (!formValidator) {
        errorMessage.textContent = 'Validation system not available. Please refresh the page.';
        errorMessage.style.display = 'block';
        return;
      }

      const validationResult = await formValidator.validateForm(formData, userType, supabaseClient);
      
      if (!validationResult.isValid) {
        // Display validation errors
        displayValidationErrors(validationResult.errors);
        errorMessage.textContent = 'Please fix the errors below before submitting.';
        errorMessage.style.display = 'block';
        return;
      }

      // Clear any existing errors
      clearAllErrors();

      let registrationData={}, tableName='';

      // Hash passwords properly (await the async function)
      const clientPassword = await window.encryption.hashPassword(validationResult.cleanData.password);
      const serviceProviderPassword = await window.encryption.hashPassword(validationResult.cleanData.spPassword);

      if(userType==='customer'){
        tableName='client';
        registrationData = {
          client_name: validationResult.cleanData.name,
          client_surname: validationResult.cleanData.surname,
          client_password: clientPassword,
          client_email: validationResult.cleanData.email,
          client_contact: validationResult.cleanData.contact,
          client_province: validationResult.cleanData.province,
          client_city: validationResult.cleanData.city,
          client_town: validationResult.cleanData.town,
          client_house_number: validationResult.cleanData.houseNumber,
          client_street_name: validationResult.cleanData.streetName,
          client_postal_code: validationResult.cleanData.postalCode,
          client_preferred_notification: document.getElementById('notification').value
        };
      } else {
        const serviceValue = document.getElementById('spService').value;
        const serviceId = serviceValue === 'custom' ? 
          document.getElementById('customServiceName').value.trim() : 
          serviceValue;

        // Get operating days
        const operatingDays = [];
        const dayCheckboxes = document.querySelectorAll('#spOperatingDays input[type="checkbox"]:checked');
        dayCheckboxes.forEach(checkbox => {
          operatingDays.push(checkbox.value);
        });

        // Get operating times
        const startTime = document.getElementById('spOperatingTimeStart').value;
        const endTime = document.getElementById('spOperatingTimeEnd').value;
        const operatingTimes = {
          start: startTime,
          end: endTime
        };

        tableName='service_provider';
        registrationData = {
          service_provider_name: validationResult.cleanData.spName,
          service_provider_surname: validationResult.cleanData.spSurname,
          service_provider_password: serviceProviderPassword,
          service_provider_email: validationResult.cleanData.spEmail,
          service_provider_contact: validationResult.cleanData.spContact,
          service_provider_location: validationResult.cleanData.spLocation,

          service_provider_base_rate: validationResult.cleanData.spBasePrice,
          service_provider_overtime_rate: validationResult.cleanData.spOvertimeRate,
          service_provider_caption: validationResult.cleanData.spCaption,
          service_provider_rating: 5,
          service_provider_description: validationResult.cleanData.spDescription,
          service_provider_service_type: serviceValue === 'custom' ? 
            validationResult.cleanData.customServiceName : 
            (document.getElementById('spService').selectedOptions.length > 0 ? 
              document.getElementById('spService').selectedOptions[0].textContent : 
              'General Service'),
          service_id: serviceId,  // Use the actual service_id from database
          
          // Add operating times and days
          service_provider_operating_days: operatingDays,
          service_provider_operating_times: operatingTimes
        };
      }

      try {
        // Check if Supabase client is available
        if (!supabaseClient) {
          throw new Error('Database connection not available. Please refresh the page and try again.');
        }
        
        const { data, error } = await supabaseClient.from(tableName).insert([registrationData]);

        if (error) {
          errorMessage.textContent = error.message;
          errorMessage.style.display = 'block';
        } 
        else {
          // ✅ Save username in localStorage
          if (userType === 'customer') {
            localStorage.setItem("userName", document.getElementById("name").value + " " + document.getElementById("surname").value);
          } else {
            localStorage.setItem("userName", document.getElementById("spName").value + " " + document.getElementById("spSurname").value);
          }

          // Registration already completed above - no duplicate needed

          // Log successful registration (only if data exists and SecuritySystem is available)
          if (data && data.length > 0 && window.SecuritySystem && window.SecuritySystem.logSecurityEvent) {
            try {
              await window.SecuritySystem.logSecurityEvent(data[0].client_id || data[0].service_provider_id, userType, 'registration_success', {
                email: userType === 'customer' ? document.getElementById("email").value : document.getElementById("spEmail").value,
                timestamp: new Date().toISOString()
              });
            } catch (logError) {
              console.warn('Security logging failed:', logError);
              // Don't fail registration if logging fails
            }
          }

          // Send welcome email via Supabase Edge Function and show notifications
          try {
            const userData = {
              id: data[0].client_id || data[0].service_provider_id,
              email: userType === 'customer' ? document.getElementById('email').value : document.getElementById('spEmail').value,
              name: userType === 'customer' ? document.getElementById('name').value : document.getElementById('spName').value,
              userType: userType
            };
            const emailResult = await sendWelcomeEmail(userData);
            if (emailResult?.success) {
              showNotification('🎉 Registration successful! A welcome email has been sent.', 'success', 4000);
            } else {
              showNotification('Registration successful, but email failed to send.', 'error', 5000);
            }
          } catch (e) {
            showNotification('Registration successful, but email failed to send.', 'error', 5000);
          }

          successMessage.textContent = "Registration successful! Redirecting to login...";
          successMessage.style.display = 'block';

          setTimeout(() => {
            window.location.href = "Login.html";
          }, 2000);
        }

      } catch (err) {
        errorMessage.textContent = err.message;
        errorMessage.style.display = 'block';
      }

    });

    // Validation function
    async function validateForm(){
      let isValid=true;
      const userType = getSelectedUserType();
      
      if (!userType) {
        document.getElementById('usertypeSelectError').textContent = 'Please select a user type';
        isValid = false;
        return isValid;
      }
      
      // Fix validation fields (remove spSlots, handle days separately)
      const formFields = userType==='customer'? 
        ['name','surname','password','confirmPassword','contact','email','province','city','town','houseNumber','streetName','postalCode','notification']:
        ['spName','spSurname','spPassword','spConfirmPassword','spContact','spEmail','spLocation','spBasePrice','spOvertimeRate','spService'];
      
      for (const fieldId of formFields) {
        if (!await validateField(document.getElementById(fieldId))) {
          isValid = false;
        }
      }

      // Additional validations for service provider
      if (userType === 'service_provider') {
        // Check operating days
        const operatingDays = document.querySelectorAll('#spOperatingDays input:checked');
        if (operatingDays.length === 0) {
          document.getElementById('spOperatingDaysError').textContent = 'Please select at least one operating day';
          isValid = false;
        } else {
          document.getElementById('spOperatingDaysError').textContent = '';
        }

        // Check custom service if selected
        const serviceSelect = document.getElementById('spService');
        if (serviceSelect.value === 'custom') {
          const customServiceName = document.getElementById('customServiceName').value.trim();
          if (!customServiceName) {
            document.getElementById('spServiceError').textContent = 'Please enter your custom service name';
            isValid = false;
          } else {
            document.getElementById('spServiceError').textContent = '';
          }
        }
      }
      
      return isValid;
    }

    // New real-time validation functions using FormValidator
    function addRealTimeValidationNew() {
      if (!formValidator) return;

      // Name and Surname validation
      const nameFields = ['name', 'surname', 'spName', 'spSurname'];
      nameFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            const result = formValidator.validateName(this.value, fieldId.includes('sp') ? 'Name' : 'Name');
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
          
          field.addEventListener('blur', function() {
            const result = formValidator.validateName(this.value, fieldId.includes('sp') ? 'Name' : 'Name');
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
        }
      });

      // Email validation
      const emailFields = ['email', 'spEmail'];
      emailFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            const result = formValidator.validateEmail(this.value);
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
          
          field.addEventListener('blur', async function() {
            const result = formValidator.validateEmail(this.value);
            if (result.isValid) {
              // Check if email exists
              const userType = getSelectedUserType();
              const emailExists = await formValidator.checkEmailExists(result.cleanValue, userType, supabaseClient);
              if (emailExists) {
                formValidator.displayErrors(fieldId, ['This email is already registered']);
              } else {
                formValidator.clearErrors(fieldId);
              }
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
        }
      });

      // Phone validation
      const phoneFields = ['contact', 'spContact'];
      phoneFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            const result = formValidator.validatePhone(this.value);
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
              // Update field with clean value
              if (this.value !== result.cleanValue) {
                this.value = result.cleanValue;
              }
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
          
          field.addEventListener('blur', async function() {
            const result = formValidator.validatePhone(this.value);
            if (result.isValid) {
              // Check if phone exists
              const userType = getSelectedUserType();
              const phoneExists = await formValidator.checkPhoneExists(result.cleanValue, userType, supabaseClient);
              if (phoneExists) {
                formValidator.displayErrors(fieldId, ['This phone number is already registered']);
              } else {
                formValidator.clearErrors(fieldId);
              }
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
        }
      });

      // Password validation
      const passwordFields = ['password', 'spPassword'];
      passwordFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            const result = formValidator.validatePassword(this.value);
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
            // Update password strength indicator
            checkPasswordStrength(fieldId);
          });
          
          field.addEventListener('blur', function() {
            const result = formValidator.validatePassword(this.value);
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
        }
      });

      // Password confirmation validation
      const passwordField = document.getElementById('password');
      const confirmPasswordField = document.getElementById('confirmPassword');
      const spPasswordField = document.getElementById('spPassword');
      const spConfirmPasswordField = document.getElementById('spConfirmPassword');

      if (passwordField && confirmPasswordField) {
        passwordField.addEventListener('input', function() {
          if (confirmPasswordField.value) {
            const result = formValidator.validatePasswordConfirmation(this.value, confirmPasswordField.value);
            if (result.isValid) {
              formValidator.clearErrors('confirmPassword');
            } else {
              formValidator.displayErrors('confirmPassword', result.errors);
            }
          }
        });
        
        confirmPasswordField.addEventListener('input', function() {
          const result = formValidator.validatePasswordConfirmation(passwordField.value, this.value);
          if (result.isValid) {
            formValidator.clearErrors('confirmPassword');
          } else {
            formValidator.displayErrors('confirmPassword', result.errors);
          }
        });
      }

      if (spPasswordField && spConfirmPasswordField) {
        spPasswordField.addEventListener('input', function() {
          if (spConfirmPasswordField.value) {
            const result = formValidator.validatePasswordConfirmation(this.value, spConfirmPasswordField.value);
            if (result.isValid) {
              formValidator.clearErrors('spConfirmPassword');
            } else {
              formValidator.displayErrors('spConfirmPassword', result.errors);
            }
          }
        });
        
        spConfirmPasswordField.addEventListener('input', function() {
          const result = formValidator.validatePasswordConfirmation(spPasswordField.value, this.value);
          if (result.isValid) {
            formValidator.clearErrors('spConfirmPassword');
          } else {
            formValidator.displayErrors('spConfirmPassword', result.errors);
          }
        });
      }

      // Service provider text validation
      const textFields = ['spCaption', 'spDescription'];
      textFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            const maxLength = fieldId === 'spCaption' ? 100 : 500;
            const result = formValidator.validateText(this.value, fieldId === 'spCaption' ? 'Caption' : 'Description', maxLength);
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
          
          field.addEventListener('blur', function() {
            const maxLength = fieldId === 'spCaption' ? 100 : 500;
            const result = formValidator.validateText(this.value, fieldId === 'spCaption' ? 'Caption' : 'Description', maxLength);
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
        }
      });

      // Service provider numeric validation
      const numericFields = ['spBasePrice', 'spOvertimeRate'];
      numericFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            const result = formValidator.validateNumeric(this.value, fieldId === 'spBasePrice' ? 'Base Price' : 'Overtime Rate');
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
              // Update field with clean value
              if (this.value !== result.cleanValue) {
                this.value = result.cleanValue;
              }
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
          
          field.addEventListener('blur', function() {
            const result = formValidator.validateNumeric(this.value, fieldId === 'spBasePrice' ? 'Base Price' : 'Overtime Rate');
            if (result.isValid) {
              formValidator.clearErrors(fieldId);
              // Update field with clean value
              if (this.value !== result.cleanValue) {
                this.value = result.cleanValue;
              }
            } else {
              formValidator.displayErrors(fieldId, result.errors);
            }
          });
        }
      });

      // Customer address fields validation
      const addressFields = [
        { id: 'province', name: 'Province' },
        { id: 'city', name: 'City' },
        { id: 'town', name: 'Town' },
        { id: 'streetName', name: 'Street Name' }
      ];
      
      addressFields.forEach(fieldInfo => {
        const field = document.getElementById(fieldInfo.id);
        if (field) {
          field.addEventListener('input', function() {
            const result = formValidator.validateAddressField(this.value, fieldInfo.name);
            if (result.isValid) {
              formValidator.clearErrors(fieldInfo.id);
            } else {
              formValidator.displayErrors(fieldInfo.id, result.errors);
            }
          });
          
          field.addEventListener('blur', function() {
            const result = formValidator.validateAddressField(this.value, fieldInfo.name);
            if (result.isValid) {
              formValidator.clearErrors(fieldInfo.id);
            } else {
              formValidator.displayErrors(fieldInfo.id, result.errors);
            }
          });
        }
      });

      // House number validation
      const houseNumberField = document.getElementById('houseNumber');
      if (houseNumberField) {
        houseNumberField.addEventListener('input', function() {
          const result = formValidator.validateHouseNumber(this.value);
          if (result.isValid) {
            formValidator.clearErrors('houseNumber');
            // Update field with clean value
            if (this.value !== result.cleanValue) {
              this.value = result.cleanValue;
            }
          } else {
            formValidator.displayErrors('houseNumber', result.errors);
          }
        });
        
        houseNumberField.addEventListener('blur', function() {
          const result = formValidator.validateHouseNumber(this.value);
          if (result.isValid) {
            formValidator.clearErrors('houseNumber');
            // Update field with clean value
            if (this.value !== result.cleanValue) {
              this.value = result.cleanValue;
            }
          } else {
            formValidator.displayErrors('houseNumber', result.errors);
          }
        });
      }

      // Postal code validation
      const postalCodeField = document.getElementById('postalCode');
      if (postalCodeField) {
        postalCodeField.addEventListener('input', function() {
          const result = formValidator.validatePostalCode(this.value);
          if (result.isValid) {
            formValidator.clearErrors('postalCode');
            // Update field with clean value
            if (this.value !== result.cleanValue) {
              this.value = result.cleanValue;
            }
          } else {
            formValidator.displayErrors('postalCode', result.errors);
          }
        });
        
        postalCodeField.addEventListener('blur', function() {
          const result = formValidator.validatePostalCode(this.value);
          if (result.isValid) {
            formValidator.clearErrors('postalCode');
            // Update field with clean value
            if (this.value !== result.cleanValue) {
              this.value = result.cleanValue;
            }
          } else {
            formValidator.displayErrors('postalCode', result.errors);
          }
        });
      }

      // Service provider location validation
      const locationField = document.getElementById('spLocation');
      if (locationField) {
        locationField.addEventListener('input', function() {
          const result = formValidator.validateAddressField(this.value, 'Location');
          if (result.isValid) {
            formValidator.clearErrors('spLocation');
          } else {
            formValidator.displayErrors('spLocation', result.errors);
          }
        });
        
        locationField.addEventListener('blur', function() {
          const result = formValidator.validateAddressField(this.value, 'Location');
          if (result.isValid) {
            formValidator.clearErrors('spLocation');
          } else {
            formValidator.displayErrors('spLocation', result.errors);
          }
        });
      }

      // Custom service name validation
      const customServiceField = document.getElementById('customServiceName');
      if (customServiceField) {
        customServiceField.addEventListener('input', function() {
          const result = formValidator.validateCustomServiceName(this.value);
          if (result.isValid) {
            formValidator.clearErrors('customServiceName');
          } else {
            formValidator.displayErrors('customServiceName', result.errors);
          }
        });
        
        customServiceField.addEventListener('blur', function() {
          const result = formValidator.validateCustomServiceName(this.value);
          if (result.isValid) {
            formValidator.clearErrors('customServiceName');
          } else {
            formValidator.displayErrors('customServiceName', result.errors);
          }
        });
      }
    }

    // Legacy real-time validation functions (kept for compatibility)
    function addRealTimeValidation() {
      // Name and Surname validation (letters only)
      const nameFields = ['name', 'surname', 'spName', 'spSurname'];
      nameFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            validateNameField(this);
          });
          field.addEventListener('blur', function() {
            validateNameField(this);
          });
        }
      });

      // Email validation
      const emailFields = ['email', 'spEmail'];
      emailFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            validateEmailField(this);
          });
          field.addEventListener('blur', async function() {
            await validateEmailField(this);
          });
        }
      });

      // Service Provider text validation (caption and description)
      const textFields = ['spCaption', 'spDescription'];
      textFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            validateTextField(this);
          });
          field.addEventListener('blur', function() {
            validateTextField(this);
          });
        }
      });

      // Service Provider numeric validation (base price and overtime rate)
      const numericFields = ['spBasePrice', 'spOvertimeRate'];
      numericFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            validateNumericField(this);
          });
          field.addEventListener('blur', function() {
            validateNumericField(this);
          });
        }
      });

      // Contact number validation
      const contactFields = ['contact', 'spContact'];
      contactFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            validateContactField(this);
          });
          field.addEventListener('blur', async function() {
            await validateContactField(this);
          });
        }
      });

      // Password validation
      const passwordFields = ['password', 'spPassword'];
      passwordFields.forEach(fieldId => {
        const field = document.getElementById(fieldId);
        if (field) {
          field.addEventListener('input', function() {
            validatePasswordField(this);
          });
          field.addEventListener('blur', function() {
            validatePasswordField(this);
          });
        }
      });

      // Password matching validation (real-time)
      const passwordField = document.getElementById('password');
      const confirmPasswordField = document.getElementById('confirmPassword');
      const spPasswordField = document.getElementById('spPassword');
      const spConfirmPasswordField = document.getElementById('spConfirmPassword');

      if (passwordField && confirmPasswordField) {
        passwordField.addEventListener('input', function() {
          if (confirmPasswordField.value) {
            validatePasswordMatch(confirmPasswordField, passwordField.value);
          }
        });
        
        confirmPasswordField.addEventListener('input', function() {
          validatePasswordMatch(this, passwordField.value);
        });
      }

      if (spPasswordField && spConfirmPasswordField) {
        spPasswordField.addEventListener('input', function() {
          if (spConfirmPasswordField.value) {
            validatePasswordMatch(spConfirmPasswordField, spPasswordField.value);
          }
        });
        
        spConfirmPasswordField.addEventListener('input', function() {
          validatePasswordMatch(this, spPasswordField.value);
        });
      }
    }

    // Name/Surname validation (letters only, no numbers or special characters)
    function validateNameField(field) {
      const value = field.value.trim();
      const errorEl = document.getElementById(field.id + 'Error');
      
      if (!value) {
        showFieldError(field, errorEl, '');
        return false;
      }
      
      // Check for letters only (including spaces for compound names)
      if (!/^[a-zA-Z\s]+$/.test(value)) {
        showFieldError(field, errorEl, 'Only letters and spaces allowed. No numbers or special characters.');
        return false;
      }
      
      // Check for numbers
      if (/\d/.test(value)) {
        showFieldError(field, errorEl, 'Numbers are not allowed in names');
        return false;
      }
      
      // Check for special characters
      if (/[^a-zA-Z\s]/.test(value)) {
        showFieldError(field, errorEl, 'Special characters are not allowed in names');
        return false;
      }
      
      // Check minimum length
      if (value.length < 2) {
        showFieldError(field, errorEl, 'Name must be at least 2 characters long');
        return false;
      }
      
      showFieldSuccess(field, errorEl);
      return true;
    }

    // Email validation
    async function validateEmailField(field) {
      const value = field.value.trim();
      const errorEl = document.getElementById(field.id + 'Error');
      
      if (!value) {
        showFieldError(field, errorEl, '');
        return false;
      }
      
      // Check email format (must have proper domain with TLD)
      const emailRegex = /^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      if (!emailRegex.test(value)) {
        showFieldError(field, errorEl, 'Invalid email format. Must include domain with extension (e.g., .com, .org)');
        return false;
      }
      
      // Additional check: Must have at least one dot after @ and proper TLD
      const domainPart = value.split('@')[1];
      if (!domainPart || !domainPart.includes('.') || domainPart.split('.').length < 2) {
        showFieldError(field, errorEl, 'Email must have a valid domain with extension (e.g., .com, .org)');
        return false;
      }
      
      // Check TLD length (must be at least 2 characters)
      const tld = domainPart.split('.').pop();
      if (tld.length < 2) {
        showFieldError(field, errorEl, 'Email domain extension must be at least 2 characters');
        return false;
      }
      
      // Check for invalid special characters
      if (/[^a-zA-Z0-9._@-]/.test(value)) {
        showFieldError(field, errorEl, 'Email contains invalid characters');
        return false;
      }
      
      // Check if email domain is valid (.com, .co, .za, etc.)
      const domain = value.split('@')[1];
      if (!domain || !/^[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(domain)) {
        showFieldError(field, errorEl, 'Invalid email domain');
        return false;
      }
      
      // Check if email already exists (only on blur to avoid too many API calls)
      if (field === document.activeElement) {
        showFieldSuccess(field, errorEl);
        return true;
      }
      
      const userType = getSelectedUserType();
      const emailExists = await checkEmailExists(value, userType);
      if (emailExists) {
        showFieldError(field, errorEl, 'This email is already registered');
        return false;
      }
      
      showFieldSuccess(field, errorEl);
      return true;
    }

    // Contact number validation (10 digits starting with 0)
    async function validateContactField(field) {
      const value = field.value.trim();
      const errorEl = document.getElementById(field.id + 'Error');
      
      if (!value) {
        showFieldError(field, errorEl, '');
        return false;
      }
      
      // Remove any non-digit characters
      const cleanValue = value.replace(/\D/g, '');
      
      // Check if it's exactly 10 digits starting with 0
      if (!/^0\d{9}$/.test(cleanValue)) {
        if (cleanValue.length === 0) {
          showFieldError(field, errorEl, 'Contact number is required');
        } else if (cleanValue.length < 10) {
          showFieldError(field, errorEl, 'Contact number must be 10 digits');
        } else if (cleanValue.length > 10) {
          showFieldError(field, errorEl, 'Contact number must be exactly 10 digits');
        } else if (!cleanValue.startsWith('0')) {
          showFieldError(field, errorEl, 'Contact number must start with 0');
        } else {
          showFieldError(field, errorEl, 'Invalid contact number format');
        }
        return false;
      }
      
      // Update the field with clean value
      if (value !== cleanValue) {
        field.value = cleanValue;
      }
      
      // Check if phone number already exists (only on blur)
      if (field === document.activeElement) {
        showFieldSuccess(field, errorEl);
        return true;
      }
      
      const userType = getSelectedUserType();
      const phoneExists = await checkPhoneExists(cleanValue, userType);
      if (phoneExists) {
        showFieldError(field, errorEl, 'This phone number is already registered');
        return false;
      }
      
      showFieldSuccess(field, errorEl);
      return true;
    }

    // Password strength validation
    function validatePasswordField(field) {
      const value = field.value;
      const errorEl = document.getElementById(field.id + 'Error');
      
      if (!value) {
        showFieldError(field, errorEl, '');
        return false;
      }
      
      // Password strength requirements
      const minLength = 8;
      const hasUpperCase = /[A-Z]/.test(value);
      const hasLowerCase = /[a-z]/.test(value);
      const hasNumbers = /\d/.test(value);
      const hasSpecialChar = /[!@#$%^&*(),.?":{}|<>]/.test(value);
      
      let errorMessage = '';
      
      if (value.length < minLength) {
        errorMessage = `Password must be at least ${minLength} characters long`;
      } else if (!hasUpperCase) {
        errorMessage = 'Password must contain at least one uppercase letter';
      } else if (!hasLowerCase) {
        errorMessage = 'Password must contain at least one lowercase letter';
      } else if (!hasNumbers) {
        errorMessage = 'Password must contain at least one number';
      } else if (!hasSpecialChar) {
        errorMessage = 'Password must contain at least one special character (!@#$%^&*(),.?":{}|<>)';
      }
      
      if (errorMessage) {
        showFieldError(field, errorEl, errorMessage);
        return false;
      }
      
      showFieldSuccess(field, errorEl);
      return true;
    }

    // Password matching validation (real-time)
    function validatePasswordMatch(confirmField, originalPassword) {
      const confirmValue = confirmField.value;
      const errorEl = document.getElementById(confirmField.id + 'Error');
      
      if (!confirmValue) {
        showFieldError(confirmField, errorEl, '');
        return false;
      }
      
      if (confirmValue !== originalPassword) {
        showFieldError(confirmField, errorEl, 'Passwords do not match');
        return false;
      }
      
      showFieldSuccess(confirmField, errorEl);
      return true;
    }

    // Text field validation (caption and description - letters, spaces, hyphens, dashes only)
    function validateTextField(field) {
      const value = field.value.trim();
      const errorEl = document.getElementById(field.id + 'Error');
      
      if (!value) {
        showFieldError(field, errorEl, '');
        return false;
      }
      
      // Allow letters, spaces, hyphens (-), and en-dashes (–) and em-dashes (—)
      // No hashtags, numbers, or other special characters
      const allowedPattern = /^[a-zA-Z\s\-–—]+$/;
      
      if (!allowedPattern.test(value)) {
        // Check for specific invalid characters
        if (/#/.test(value)) {
          showFieldError(field, errorEl, 'Hashtags (#) are not allowed. Use letters, spaces, and hyphens only.');
        } else if (/\d/.test(value)) {
          showFieldError(field, errorEl, 'Numbers are not allowed. Use letters, spaces, and hyphens only.');
        } else if (/[!@$%^&*()_+=\[\]{};':"\\|,.<>\/?~`]/.test(value)) {
          showFieldError(field, errorEl, 'Special characters are not allowed. Use letters, spaces, and hyphens only.');
        } else {
          showFieldError(field, errorEl, 'Only letters, spaces, and hyphens (-) are allowed');
        }
        return false;
      }
      
      // Check length based on field type
      if (field.id === 'spCaption' && value.length > 100) {
        showFieldError(field, errorEl, 'Caption must be 100 characters or less');
        return false;
      }
      
      if (field.id === 'spDescription' && value.length > 500) {
        showFieldError(field, errorEl, 'Description must be 500 characters or less');
        return false;
      }
      
      showFieldSuccess(field, errorEl);
      return true;
    }

    // Numeric field validation (base price and overtime rate - numbers only)
    function validateNumericField(field) {
      const value = field.value.trim();
      const errorEl = document.getElementById(field.id + 'Error');
      
      if (!value) {
        showFieldError(field, errorEl, '');
        return false;
      }
      
      // Remove any non-numeric characters except decimal point
      const cleanValue = value.replace(/[^0-9.]/g, '');
      
      // Check if it's a valid positive number
      const numValue = parseFloat(cleanValue);
      
      if (isNaN(numValue)) {
        showFieldError(field, errorEl, 'Please enter a valid number');
        return false;
      }
      
      if (numValue < 0) {
        showFieldError(field, errorEl, 'Price must be a positive number');
        return false;
      }
      
      if (numValue > 999999) {
        showFieldError(field, errorEl, 'Price cannot exceed R999,999');
        return false;
      }
      
      // Update field with clean value if it changed
      if (value !== cleanValue) {
        field.value = cleanValue;
      }
      
      showFieldSuccess(field, errorEl);
      return true;
    }

    // Helper functions for field validation display
    function showFieldError(field, errorEl, message) {
      if (errorEl) {
        errorEl.textContent = message;
        errorEl.style.color = '#dc3545';
        errorEl.style.fontSize = '0.875rem';
        errorEl.style.marginTop = '0.25rem';
      }
      field.classList.add('is-invalid');
      field.classList.remove('is-valid');
    }

    function showFieldSuccess(field, errorEl) {
      if (errorEl) {
        errorEl.textContent = '';
      }
      field.classList.remove('is-invalid');
      field.classList.add('is-valid');
    }

    async function validateField(field){
      const value=field.value.trim(), id=field.id;
      let message='', valid=true;
      const userType = getSelectedUserType();
      
      switch(id){
        case 'name': case 'surname': case 'spName': case 'spSurname':
          if(!value){message='Required'; valid=false;}
          else if(!/^[a-zA-Z\s]+$/.test(value)){message='Only letters allowed'; valid=false;}
          break;
        case 'password': case 'spPassword':
          if(!value){message='Required'; valid=false;}
          else if(value.length<8){message='Minimum 8 characters required'; valid=false;}
          else if(!/(?=.*[a-zA-Z])/.test(value)){message='Must contain at least one letter'; valid=false;}
          else if(!/(?=.*[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?])/.test(value)){message='Must contain at least one special character'; valid=false;}
          else if(!/(?=.*\d)/.test(value)){message='Must contain at least one number'; valid=false;}
          break;
        case 'confirmPassword': case 'spConfirmPassword':
          const pwd=document.getElementById(id==='confirmPassword'?'password':'spPassword').value;
          if(!value){message='Please confirm your password'; valid=false;}
          else if(value!==pwd){message='Passwords do not match'; valid=false;}
          break;
        case 'contact': case 'spContact':
          if(!value){message='Required'; valid=false;}
          else if(!/^0[0-9]{9}$/.test(value)){message='Must be 10 digits starting with 0'; valid=false;}
          else {
            // Check if phone number already exists
            const phoneExists = await checkPhoneExists(value, userType);
            if(phoneExists){message='This phone number is already registered'; valid=false;}
          }
          break;
        case 'email': case 'spEmail':
          if(!value){message='Required'; valid=false;}
          else if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)){message='Invalid email format'; valid=false;}
          else {
            // Check if email already exists (case insensitive)
            const emailExists = await checkEmailExists(value, userType);
            if(emailExists){message='This email is already registered'; valid=false;}
          }
          break;
        case 'postalCode': if(!value){message='Required'; valid=false;} break;
        case 'spBasePrice': case 'spOvertimeRate':
          if(!value || isNaN(value) || parseFloat(value) <= 0){message='Must be a valid positive number greater than 0'; valid=false;} 
          else if(parseFloat(value) < 1){message='Rate must be at least R1.00'; valid=false;}
          break;
        case 'spService': 
          if(!value){message='Select a service'; valid=false;} 
          else if(value === 'custom') {
            const customName = document.getElementById('customServiceName').value.trim();
            if(!customName){message='Enter custom service name'; valid=false;}
          }
          break;
        case 'spCaption':
          if(!value){message='Required'; valid=false;}
          else if(value.length > 100){message='Caption too long (max 100 characters)'; valid=false;}
          break;
        case 'spDescription':
          if(!value){message='Required'; valid=false;}
          else if(value.length > 500){message='Description too long (max 500 characters)'; valid=false;}
          break;
        default: if(!value){message='Required'; valid=false;}
      }
      
      const errorEl = document.getElementById(id+'Error');
      if(!valid) {
        errorEl.textContent=message;
        field.classList.add('is-invalid');
        field.classList.remove('is-valid');
      } else {
        errorEl.textContent='';
        field.classList.remove('is-invalid');
        if(value) field.classList.add('is-valid');
      }
      return valid;
    }

  });

  </script>

  <!-- Fallback Registration Script - REMOVED -->
  <!-- The fallback script was conflicting with the main Supabase registration logic above -->
  <!-- The main registrationForm.addEventListener('submit', async (e) => {...}) handles everything properly -->

  <!-- Email Notification Service (optional, if present will be used) -->
  <script src="js/email-notification-service.js"></script>

  <!-- EmailJS (client-side email sending, no CLI) -->
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script>
    (function() {
      if (window.emailjs && !window.__emailjsInitialized) {
        // TODO: replace with your actual public key from EmailJS dashboard
        emailjs.init("gc14Sm6c9463FqhBE");
        window.__emailjsInitialized = true;
      }
    })();

    async function sendWelcomeEmail(userData) {
      try {
        const templateParams = {
          to_name: userData.name,
          to_email: userData.email,
          user_type: userData.userType,
          message: `Welcome to Bonica! Your ${userData.userType} account has been created.`
        };

        // TODO: replace with your actual service and template IDs from EmailJS
        const serviceId = "service_qrizxj2";
        const templateId = "template_uywdohj";

        const res = await emailjs.send(serviceId, templateId, templateParams);
        return { success: true, data: res };
      } catch (err) {
        console.error('EmailJS error:', err);
        return { success: false, error: err?.text || err?.message || 'Email send failed' };
      }
    }
  </script>

  <!-- Global welcome email fallback wrapper to ensure function exists -->
  <script>
    if (typeof window.sendWelcomeEmail !== 'function') {
      window.sendWelcomeEmail = async function(userData) {
        try {
          // 1) Use external EmailNotificationService if available
          if (window.emailNotificationService && typeof window.emailNotificationService.sendProfileCreatedEmail === 'function') {
            const res = await window.emailNotificationService.sendProfileCreatedEmail(userData);
            return res && res.success ? { success: true, data: res } : { success: false, error: res?.error || 'Email service failed' };
          }

          // 2) Try EmailJS if loaded
          if (window.emailjs && typeof emailjs.send === 'function') {
            const templateParams = {
              to_name: userData.name,
              to_email: userData.email,
              user_type: userData.userType,
              message: `Welcome to Bonica! Your ${userData.userType} account has been created.`
            };
            const res = await emailjs.send('YOUR_SERVICE_ID', 'YOUR_TEMPLATE_ID', templateParams);
            return { success: true, data: res };
          }

          // 3) Fallback to Supabase Edge Function if configured
          const endpoint = 'https://spudtrptbyvwyhvistdf.supabase.co/functions/v1/send-email';
          let headers = { 'Content-Type': 'application/json' };
          try {
            if (window.supabase && window.supabase.auth) {
              const { data: { session } } = await window.supabase.auth.getSession();
              if (session?.access_token) {
                headers['Authorization'] = `Bearer ${session.access_token}`;
              }
            }
          } catch {}

          const response = await fetch(endpoint, {
            method: 'POST',
            headers,
            body: JSON.stringify({
              email: userData.email,
              subject: '🎉 Welcome to Bonica!',
              message: `Hi ${userData.name}, your ${userData.userType} account has been successfully created.`
            })
          });
          const result = await response.json().catch(() => null);
          return response.ok && result?.success ? { success: true, data: result } : { success: false, error: result?.error || 'Email send failed' };
        } catch (e) {
          return { success: false, error: e?.message || 'Unknown email error' };
        }
      }
    }
  </script>

  <!-- Lightweight notifications UI -->
  <style>
    #notificationContainer { position: fixed; top: 20px; right: 20px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
    .notification { min-width: 280px; max-width: 380px; padding: 12px 14px; border-radius: 10px; color: #111827; background: #ffffff; box-shadow: 0 8px 24px rgba(0,0,0,0.12); border-left: 4px solid #3b82f6; opacity: 0; transform: translateY(-6px); transition: opacity .2s ease, transform .2s ease; }
    .notification.show { opacity: 1; transform: translateY(0); }
    .notification.success { border-left-color: #10b981; }
    .notification.error { border-left-color: #ef4444; }
    .notification.info { border-left-color: #3b82f6; }
  </style>
  <div id="notificationContainer"></div>
  <script>
    function showNotification(message, type = 'info', duration = 3500) {
      try {
        const container = document.getElementById('notificationContainer');
        if (!container) return;
        const el = document.createElement('div');
        el.className = `notification ${type}`;
        el.innerHTML = `<div style="display:flex; gap:8px; align-items:flex-start;">
                          <span style="font-weight:600;">${type === 'success' ? 'Success' : type === 'error' ? 'Error' : 'Info'}</span>
                          <span style="color:#6b7280;">${message}</span>
                        </div>`;
        container.appendChild(el);
        requestAnimationFrame(() => el.classList.add('show'));
        setTimeout(() => {
          el.classList.remove('show');
          setTimeout(() => el.remove(), 200);
        }, duration);
      } catch {}
    }
  </script>

  <!-- Back to top & small UI script (Bonica style) -->
  <script>
    // Back to top button
    const backToTopBtn = document.querySelector('.back-to-top');
    if (backToTopBtn) {
    window.addEventListener('scroll', () => {
      if (window.pageYOffset > 300) backToTopBtn.classList.add('show');
      else backToTopBtn.classList.remove('show');
    });
    backToTopBtn.addEventListener('click', e => {
      e.preventDefault();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
    }

    // Mobile menu toggle function
    function toggleMobileMenu() {
      const navLinks = document.getElementById('navLinks');
      if (navLinks) {
        navLinks.classList.toggle('active');
      }
    }
  </script>
</body>
</html>
