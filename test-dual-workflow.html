<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Dual Workflow System - Bonica</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
        
        .test-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .test-header {
            background: linear-gradient(135deg, #0d6efd 0%, #0056b3 100%);
            color: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            text-align: center;
            box-shadow: 0 8px 25px rgba(13, 110, 253, 0.3);
        }
        
        .test-section {
            background: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .workflow-step {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            border-left: 4px solid #0d6efd;
            transition: all 0.3s ease;
        }
        
        .workflow-step.active {
            border-left-color: #28a745;
            background: #d4edda;
        }
        
        .workflow-step.completed {
            border-left-color: #6c757d;
            background: #e9ecef;
            opacity: 0.7;
        }
        
        .step-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .step-number {
            background: #0d6efd;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 1rem;
        }
        
        .step-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #212529;
            flex: 1;
        }
        
        .step-status {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .status-pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status-active {
            background: #d1e7dd;
            color: #0f5132;
        }
        
        .status-completed {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .test-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .btn-test {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn-primary-test {
            background: #0d6efd;
            color: white;
        }
        
        .btn-primary-test:hover {
            background: #0b5ed7;
            transform: translateY(-2px);
        }
        
        .btn-success-test {
            background: #28a745;
            color: white;
        }
        
        .btn-success-test:hover {
            background: #218838;
            transform: translateY(-2px);
        }
        
        .btn-warning-test {
            background: #ffc107;
            color: #212529;
        }
        
        .btn-warning-test:hover {
            background: #e0a800;
            transform: translateY(-2px);
        }
        
        .btn-danger-test {
            background: #dc3545;
            color: white;
        }
        
        .btn-danger-test:hover {
            background: #bb2d3b;
            transform: translateY(-2px);
        }
        
        .log-container {
            background: #212529;
            color: #fff;
            border-radius: 10px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1rem;
        }
        
        .log-entry {
            margin-bottom: 0.5rem;
            padding: 0.25rem 0;
        }
        
        .log-success {
            color: #28a745;
        }
        
        .log-error {
            color: #dc3545;
        }
        
        .log-warning {
            color: #ffc107;
        }
        
        .log-info {
            color: #17a2b8;
        }
        
        .dual-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .client-view {
            background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
            border-radius: 10px;
            padding: 1.5rem;
        }
        
        .provider-view {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 10px;
            padding: 1.5rem;
        }
        
        .view-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .view-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
            color: white;
            font-weight: 600;
        }
        
        .client-icon {
            background: #28a745;
        }
        
        .provider-icon {
            background: #0d6efd;
        }
        
        .view-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #212529;
        }
        
        .test-data {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }
        
        .data-item {
            display: flex;
            justify-content: between;
            margin-bottom: 0.5rem;
        }
        
        .data-label {
            font-weight: 600;
            color: #6c757d;
        }
        
        .data-value {
            color: #212529;
        }
        
        .progress-container {
            margin: 2rem 0;
        }
        
        .progress {
            height: 8px;
            border-radius: 4px;
        }
        
        .progress-bar {
            transition: width 0.5s ease;
        }
        
        @media (max-width: 768px) {
            .test-container {
                padding: 1rem;
            }
            
            .dual-view {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .test-controls {
                flex-direction: column;
            }
            
            .btn-test {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="test-container">
        <!-- Test Header -->
        <div class="test-header">
            <h1><i class="fas fa-flask me-2"></i>Dual Workflow System Test</h1>
            <p class="mb-0">Complete end-to-end testing of the client ‚Üî service provider workflow</p>
        </div>

        <!-- Test Controls -->
        <div class="test-section">
            <h3><i class="fas fa-play-circle me-2"></i>Test Controls</h3>
            <div class="test-controls">
                <button class="btn btn-primary-test" onclick="initializeTest()">
                    <i class="fas fa-power-off me-1"></i>Initialize Test
                </button>
                <button class="btn btn-success-test" onclick="simulateClientBooking()">
                    <i class="fas fa-user-plus me-1"></i>Simulate Client Booking
                </button>
                <button class="btn btn-warning-test" onclick="simulateServiceProviderResponse()">
                    <i class="fas fa-briefcase me-1"></i>Simulate Provider Response
                </button>
                <button class="btn btn-danger-test" onclick="resetTest()">
                    <i class="fas fa-redo me-1"></i>Reset Test
                </button>
                <button class="btn btn-primary-test" onclick="runFullWorkflow()">
                    <i class="fas fa-rocket me-1"></i>Run Full Workflow
                </button>
            </div>
            
            <div class="progress-container">
                <div class="progress">
                    <div class="progress-bar bg-success" role="progressbar" style="width: 0%" id="workflow-progress"></div>
                </div>
                <div class="text-center mt-2">
                    <small class="text-muted">Workflow Progress: <span id="progress-text">0%</span></small>
                </div>
            </div>
        </div>

        <!-- Workflow Steps -->
        <div class="test-section">
            <h3><i class="fas fa-list-ol me-2"></i>Workflow Steps</h3>
            
            <div class="workflow-step" id="step-1">
                <div class="step-header">
                    <div class="step-number">1</div>
                    <div class="step-title">Client Creates Event Booking</div>
                    <div class="step-status status-pending" id="step-1-status">Pending</div>
                </div>
                <p class="mb-0">Client selects event details, services (MC, Makeup, Decoration), and creates <strong>one job cart per service</strong></p>
            </div>

            <div class="workflow-step" id="step-2">
                <div class="step-header">
                    <div class="step-number">2</div>
                    <div class="step-title">Service Providers Get Notified</div>
                    <div class="step-status status-pending" id="step-2-status">Pending</div>
                </div>
                <p class="mb-0">Real-time notifications sent to relevant service providers about new job carts (3 job carts = 3 notifications)</p>
            </div>

            <div class="workflow-step" id="step-3">
                <div class="step-header">
                    <div class="step-number">3</div>
                    <div class="step-title">Service Providers Accept Job Carts</div>
                    <div class="step-status status-pending" id="step-3-status">Pending</div>
                </div>
                <p class="mb-0">Service providers accept job carts with concurrent access control</p>
            </div>

            <div class="workflow-step" id="step-4">
                <div class="step-header">
                    <div class="step-number">4</div>
                    <div class="step-title">Service Providers Upload Quotations</div>
                    <div class="step-status status-pending" id="step-4-status">Pending</div>
                </div>
                <p class="mb-0">Accepted service providers upload detailed quotations with pricing</p>
            </div>

            <div class="workflow-step" id="step-5">
                <div class="step-header">
                    <div class="step-number">5</div>
                    <div class="step-title">Client Reviews Quotations</div>
                    <div class="step-status status-pending" id="step-5-status">Pending</div>
                </div>
                <p class="mb-0">Client receives real-time updates and reviews all quotations</p>
            </div>

            <div class="workflow-step" id="step-6">
                <div class="step-header">
                    <div class="step-number">6</div>
                    <div class="step-title">Client Selects Final Quotations</div>
                    <div class="step-status status-pending" id="step-6-status">Pending</div>
                </div>
                <p class="mb-0">Client chooses preferred quotations and finalizes the booking</p>
            </div>
        </div>

        <!-- Dual View -->
        <div class="dual-view">
            <!-- Client View -->
            <div class="client-view">
                <div class="view-header">
                    <div class="view-icon client-icon">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="view-title">Client View</div>
                </div>
                
                <div class="test-data" id="client-data">
                    <h6>Client Information</h6>
                    <div class="data-item">
                        <span class="data-label">Name:</span>
                        <span class="data-value" id="client-name">-</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Event:</span>
                        <span class="data-value" id="client-event">-</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Services:</span>
                        <span class="data-value" id="client-services">-</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Job Carts:</span>
                        <span class="data-value" id="client-job-carts">-</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Quotations Received:</span>
                        <span class="data-value" id="client-quotations">-</span>
                    </div>
                </div>
                
                <div class="test-data">
                    <h6>Client Actions</h6>
                    <div id="client-actions">
                        <p class="text-muted">No actions yet</p>
                    </div>
                </div>
            </div>

            <!-- Service Provider View -->
            <div class="provider-view">
                <div class="view-header">
                    <div class="view-icon provider-icon">
                        <i class="fas fa-briefcase"></i>
                    </div>
                    <div class="view-title">Service Provider View</div>
                </div>
                
                <div class="test-data" id="provider-data">
                    <h6>Service Provider Information</h6>
                    <div class="data-item">
                        <span class="data-label">Name:</span>
                        <span class="data-value" id="provider-name">-</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Services:</span>
                        <span class="data-value" id="provider-services">-</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Notifications:</span>
                        <span class="data-value" id="provider-notifications">-</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Accepted Jobs:</span>
                        <span class="data-value" id="provider-accepted">-</span>
                    </div>
                    <div class="data-item">
                        <span class="data-label">Quotations Uploaded:</span>
                        <span class="data-value" id="provider-quotations">-</span>
                    </div>
                </div>
                
                <div class="test-data">
                    <h6>Service Provider Actions</h6>
                    <div id="provider-actions">
                        <p class="text-muted">No actions yet</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Test Log -->
        <div class="test-section">
            <h3><i class="fas fa-terminal me-2"></i>Test Log</h3>
            <div class="log-container" id="test-log">
                <div class="log-entry log-info">[INFO] Test system initialized. Ready to begin dual workflow testing.</div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Supabase JS -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Services -->
    <script src="js/supabase-config.js"></script>
    <script src="js/database-service.js"></script>
    <script src="js/realtime-service.js"></script>
    <script src="js/job-cart-manager.js"></script>
    <script src="js/notification-system.js"></script>

    <script>
        // Test state
        let testState = {
            initialized: false,
            currentStep: 0,
            clientData: null,
            providerData: null,
            jobCarts: [],
            quotations: [],
            notifications: []
        };

        // Test data
        const testClientData = {
            client_id: 'test-client-001',
            client_name: 'John',
            client_surname: 'Smith',
            client_email: 'john.smith@test.com',
            client_contact: '+27 82 123 4567',
            event_name: 'Wedding Reception',
            event_date: '2025-04-15',
            event_location: 'Johannesburg Convention Centre',
            services: ['MC', 'Makeup Artist', 'Decoration']
        };

        const testProviderData = [
            {
                service_provider_id: 'test-provider-001',
                service_provider_name: 'Sarah',
                service_provider_surname: 'Johnson',
                service_provider_email: 'sarah.johnson@test.com',
                service_provider_services: ['MC', 'Host/Presenter'],
                service_provider_location: 'Johannesburg'
            },
            {
                service_provider_id: 'test-provider-002',
                service_provider_name: 'Lisa',
                service_provider_surname: 'Williams',
                service_provider_email: 'lisa.williams@test.com',
                service_provider_services: ['Makeup Artist', 'Beauty Services'],
                service_provider_location: 'Johannesburg'
            },
            {
                service_provider_id: 'test-provider-003',
                service_provider_name: 'Mike',
                service_provider_surname: 'Brown',
                service_provider_email: 'mike.brown@test.com',
                service_provider_services: ['Decoration', 'Florist'],
                service_provider_location: 'Johannesburg'
            }
        ];

        // Initialize test
        async function initializeTest() {
            try {
                logMessage('Initializing dual workflow test system...', 'info');
                
                // Initialize services
                await initializeServices();
                
                // Set test data
                testState.clientData = testClientData;
                testState.providerData = testProviderData;
                testState.initialized = true;
                
                // Update UI
                updateClientView();
                updateProviderView();
                
                logMessage('‚úÖ Test system initialized successfully', 'success');
                logMessage(`Client: ${testClientData.client_name} ${testClientData.client_surname}`, 'info');
                logMessage(`Providers: ${testProviderData.length} service providers ready`, 'info');
                
            } catch (error) {
                logMessage(`‚ùå Failed to initialize test: ${error.message}`, 'error');
            }
        }

        // Initialize services
        async function initializeServices() {
            try {
                // Initialize Supabase
                if (!window.supabase) {
                    throw new Error('Supabase not available');
                }
                
                // Initialize database service
                if (window.DatabaseService) {
                    window.databaseService = new DatabaseService(window.supabase);
                    await window.databaseService.initialize();
                }
                
                // Initialize realtime service
                if (window.RealtimeService) {
                    await window.RealtimeService.initialize(window.supabase);
                }
                
                logMessage('‚úÖ Services initialized', 'success');
            } catch (error) {
                logMessage(`‚ùå Service initialization failed: ${error.message}`, 'error');
                throw error;
            }
        }

        // Simulate client booking
        async function simulateClientBooking() {
            try {
                if (!testState.initialized) {
                    throw new Error('Test not initialized');
                }
                
                logMessage('üéØ Simulating client booking process...', 'info');
                
                // Step 1: Create event
                const eventData = await createTestEvent();
                logMessage(`‚úÖ Event created: ${eventData.event_name}`, 'success');
                
                // Step 2: Create booking
                const bookingData = await createTestBooking(eventData.event_id);
                logMessage(`‚úÖ Booking created: ${bookingData.booking_id}`, 'success');
                
                // Step 3: Create job carts
                testState.jobCarts = await createTestJobCarts(eventData.event_id);
                logMessage(`‚úÖ Job carts created: ${testState.jobCarts.length} carts`, 'success');
                
                // Update progress
                updateStep(1, 'completed');
                updateStep(2, 'active');
                updateProgress();
                
                // Update views
                updateClientView();
                
                logMessage('üéâ Client booking simulation completed!', 'success');
                
            } catch (error) {
                logMessage(`‚ùå Client booking simulation failed: ${error.message}`, 'error');
            }
        }

        // Simulate service provider response
        async function simulateServiceProviderResponse() {
            try {
                if (testState.jobCarts.length === 0) {
                    throw new Error('No job carts available');
                }
                
                logMessage('üéØ Simulating service provider responses...', 'info');
                
                // Step 2: Notify service providers
                await notifyServiceProviders();
                updateStep(2, 'completed');
                updateStep(3, 'active');
                
                // Step 3: Service providers accept job carts
                await simulateJobCartAcceptance();
                updateStep(3, 'completed');
                updateStep(4, 'active');
                
                // Step 4: Service providers upload quotations
                await simulateQuotationUpload();
                updateStep(4, 'completed');
                updateStep(5, 'active');
                
                // Update progress
                updateProgress();
                
                // Update views
                updateProviderView();
                
                logMessage('üéâ Service provider response simulation completed!', 'success');
                
            } catch (error) {
                logMessage(`‚ùå Service provider response simulation failed: ${error.message}`, 'error');
            }
        }

        // Create test event
        async function createTestEvent() {
            const eventData = {
                event_name: testState.clientData.event_name,
                event_date: testState.clientData.event_date,
                event_location: testState.clientData.event_location,
                event_start_time: '18:00',
                event_end_time: '23:00',
                client_id: testState.clientData.client_id,
                event_description: 'Wedding reception with live music and catering'
            };
            
            // In a real test, you would insert into database
            // For simulation, we'll create mock data
            eventData.event_id = `test-event-${Date.now()}`;
            
            return eventData;
        }

        // Create test booking
        async function createTestBooking(eventId) {
            const bookingData = {
                booking_id: `test-booking-${Date.now()}`,
                booking_date: testState.clientData.event_date,
                booking_start_time: '18:00',
                booking_end_time: '23:00',
                booking_status: 'active',
                booking_total_price: 25000,
                booking_special_request: 'Vegetarian catering required, outdoor ceremony',
                client_id: testState.clientData.client_id,
                event_id: eventId
            };
            
            return bookingData;
        }

        // Create test job carts (ONE job cart per service)
        async function createTestJobCarts(eventId) {
            const jobCarts = testState.clientData.services.map((service, index) => ({
                job_cart_id: `test-job-cart-${index + 1}-${Date.now()}`,
                event_id: eventId,
                job_cart_item: service,  // ONE service per job cart
                job_cart_details: `Professional ${service.toLowerCase()} service for wedding reception. Available to all verified ${service} providers.`,
                job_cart_created_date: new Date().toISOString().split('T')[0],
                job_cart_created_time: new Date().toLocaleTimeString('en-ZA', { hour12: false }),
                job_cart_status: 'available'  // Multiple providers can accept this job cart
            }));
            
            return jobCarts;
        }

        // Notify service providers
        async function notifyServiceProviders() {
            logMessage('üì¢ Notifying service providers...', 'info');
            
            for (const provider of testState.providerData) {
                const relevantJobCarts = testState.jobCarts.filter(jobCart => 
                    provider.service_provider_services.some(service => 
                        service.toLowerCase().includes(jobCart.job_cart_item.toLowerCase()) ||
                        jobCart.job_cart_item.toLowerCase().includes(service.toLowerCase())
                    )
                );
                
                if (relevantJobCarts.length > 0) {
                    logMessage(`üìß Notified ${provider.service_provider_name}: ${relevantJobCarts.length} relevant job carts`, 'success');
                    
                    // Create notifications
                    relevantJobCarts.forEach(jobCart => {
                        const notification = {
                            notification_type: 'new_job_cart',
                            notification_title: 'New Job Available',
                            notification_message: `A new job cart has been created for "${jobCart.job_cart_item}". Click to view details.`,
                            notification_date: new Date().toISOString().split('T')[0],
                            notification_time: new Date().toLocaleTimeString('en-ZA', { hour12: false }),
                            notification_status: 'unread',
                            user_type: 'service_provider',
                            user_id: provider.service_provider_id,
                            job_cart_id: jobCart.job_cart_id,
                            event_id: jobCart.event_id
                        };
                        
                        testState.notifications.push(notification);
                    });
                }
            }
        }

        // Simulate job cart acceptance
        async function simulateJobCartAcceptance() {
            logMessage('ü§ù Simulating job cart acceptance...', 'info');
            
            for (const jobCart of testState.jobCarts) {
                // Find relevant provider
                const relevantProvider = testState.providerData.find(provider =>
                    provider.service_provider_services.some(service =>
                        service.toLowerCase().includes(jobCart.job_cart_item.toLowerCase()) ||
                        jobCart.job_cart_item.toLowerCase().includes(service.toLowerCase())
                    )
                );
                
                if (relevantProvider) {
                    // Simulate acceptance
                    jobCart.job_cart_status = 'accepted';
                    jobCart.accepted_by = relevantProvider.service_provider_id;
                    
                    logMessage(`‚úÖ ${relevantProvider.service_provider_name} accepted job cart: ${jobCart.job_cart_item}`, 'success');
                }
            }
        }

        // Simulate quotation upload
        async function simulateQuotationUpload() {
            logMessage('üí∞ Simulating quotation upload...', 'info');
            
            for (const jobCart of testState.jobCarts) {
                if (jobCart.job_cart_status === 'accepted') {
                    const provider = testState.providerData.find(p => p.service_provider_id === jobCart.accepted_by);
                    
                    const quotation = {
                        quotation_id: `test-quotation-${jobCart.job_cart_id}-${Date.now()}`,
                        service_provider_id: jobCart.accepted_by,
                        job_cart_id: jobCart.job_cart_id,
                        quotation_price: Math.floor(Math.random() * 10000) + 5000, // Random price between 5000-15000
                        quotation_details: `Professional ${jobCart.job_cart_item.toLowerCase()} service with premium quality and excellent customer service`,
                        quotation_file_path: `quotations/${jobCart.job_cart_id}-quotation.pdf`,
                        quotation_file_name: `${jobCart.job_cart_item}-quotation.pdf`,
                        quotation_submission_date: new Date().toISOString().split('T')[0],
                        quotation_submission_time: new Date().toLocaleTimeString('en-ZA', { hour12: false }),
                        quotation_status: 'pending'
                    };
                    
                    testState.quotations.push(quotation);
                    
                    logMessage(`üìÑ ${provider.service_provider_name} uploaded quotation: R${quotation.quotation_price}`, 'success');
                }
            }
        }

        // Run full workflow
        async function runFullWorkflow() {
            try {
                logMessage('üöÄ Running complete dual workflow...', 'info');
                
                await simulateClientBooking();
                await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds
                await simulateServiceProviderResponse();
                await new Promise(resolve => setTimeout(resolve, 2000)); // Wait 2 seconds
                
                // Final step: Client selects quotations
                updateStep(5, 'completed');
                updateStep(6, 'active');
                updateProgress();
                
                logMessage('üéâ Complete dual workflow test finished!', 'success');
                logMessage(`üìä Summary: ${testState.jobCarts.length} job carts, ${testState.quotations.length} quotations`, 'info');
                
            } catch (error) {
                logMessage(`‚ùå Full workflow test failed: ${error.message}`, 'error');
            }
        }

        // Update step status
        function updateStep(stepNumber, status) {
            const step = document.getElementById(`step-${stepNumber}`);
            const statusElement = document.getElementById(`step-${stepNumber}-status`);
            
            step.className = `workflow-step ${status === 'completed' ? 'completed' : status === 'active' ? 'active' : ''}`;
            statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            statusElement.className = `step-status status-${status}`;
            
            testState.currentStep = stepNumber;
        }

        // Update progress
        function updateProgress() {
            const progress = (testState.currentStep / 6) * 100;
            document.getElementById('workflow-progress').style.width = `${progress}%`;
            document.getElementById('progress-text').textContent = `${Math.round(progress)}%`;
        }

        // Update client view
        function updateClientView() {
            if (!testState.clientData) return;
            
            document.getElementById('client-name').textContent = `${testState.clientData.client_name} ${testState.clientData.client_surname}`;
            document.getElementById('client-event').textContent = testState.clientData.event_name;
            document.getElementById('client-services').textContent = testState.clientData.services.join(', ');
            document.getElementById('client-job-carts').textContent = testState.jobCarts.length;
            document.getElementById('client-quotations').textContent = testState.quotations.length;
            
            // Update client actions
            const clientActions = document.getElementById('client-actions');
            if (testState.jobCarts.length > 0) {
                clientActions.innerHTML = `
                    <div class="mb-2">
                        <strong>‚úÖ Event Created:</strong> ${testState.clientData.event_name}
                    </div>
                    <div class="mb-2">
                        <strong>‚úÖ Job Carts Created:</strong> ${testState.jobCarts.length} services
                    </div>
                    ${testState.quotations.length > 0 ? `
                        <div class="mb-2">
                            <strong>üìÑ Quotations Received:</strong> ${testState.quotations.length} quotations
                        </div>
                    ` : `
                        <div class="mb-2 text-muted">
                            <strong>‚è≥ Waiting for quotations...</strong>
                        </div>
                    `}
                `;
            }
        }

        // Update provider view
        function updateProviderView() {
            if (!testState.providerData) return;
            
            // Update provider data
            document.getElementById('provider-name').textContent = `${testState.providerData.length} Providers`;
            document.getElementById('provider-services').textContent = testState.providerData.map(p => p.service_provider_services.join(', ')).join('; ');
            document.getElementById('provider-notifications').textContent = testState.notifications.length;
            document.getElementById('provider-accepted').textContent = testState.jobCarts.filter(jc => jc.job_cart_status === 'accepted').length;
            document.getElementById('provider-quotations').textContent = testState.quotations.length;
            
            // Update provider actions
            const providerActions = document.getElementById('provider-actions');
            if (testState.notifications.length > 0) {
                providerActions.innerHTML = `
                    <div class="mb-2">
                        <strong>üì¢ Notifications Sent:</strong> ${testState.notifications.length}
                    </div>
                    <div class="mb-2">
                        <strong>ü§ù Job Carts Accepted:</strong> ${testState.jobCarts.filter(jc => jc.job_cart_status === 'accepted').length}
                    </div>
                    ${testState.quotations.length > 0 ? `
                        <div class="mb-2">
                            <strong>üí∞ Quotations Uploaded:</strong> ${testState.quotations.length}
                        </div>
                    ` : ''}
                `;
            }
        }

        // Reset test
        function resetTest() {
            testState = {
                initialized: false,
                currentStep: 0,
                clientData: null,
                providerData: null,
                jobCarts: [],
                quotations: [],
                notifications: []
            };
            
            // Reset UI
            for (let i = 1; i <= 6; i++) {
                updateStep(i, 'pending');
            }
            
            updateProgress();
            updateClientView();
            updateProviderView();
            
            // Clear log
            document.getElementById('test-log').innerHTML = '<div class="log-entry log-info">[INFO] Test system reset. Ready to begin new test.</div>';
            
            logMessage('üîÑ Test system reset', 'warning');
        }

        // Log message
        function logMessage(message, type = 'info') {
            const logContainer = document.getElementById('test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry log-${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            logMessage('Test system loaded and ready', 'success');
        });
    </script>
</body>
</html>
